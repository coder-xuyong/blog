<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.66" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://coder-xuyong.github.io/blog/blog/pages/128c54/"><meta property="og:site_name" content="coder-xuyong"><meta property="og:title" content="Spring ä¹‹äº‹åŠ¡"><meta property="og:description" content="Spring ä¹‹äº‹åŠ¡ Spring é’ˆå¯¹ Java Transaction API (JTA)ã€JDBCã€Hibernate å’Œ Java Persistence API(JPA) ç­‰äº‹åŠ¡ APIï¼Œå®ç°äº†ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ï¼Œè€Œ Spring çš„å£°æ˜å¼äº‹åŠ¡åŠŸèƒ½æ›´æ˜¯æä¾›äº†æå…¶æ–¹ä¾¿çš„äº‹åŠ¡é…ç½®æ–¹å¼ï¼Œé…åˆ Spring Boot çš„è‡ªåŠ¨é…ç½®ï¼Œå¤§å¤šæ•° Spring B..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/dunwu/images/master/snap/20220922073737.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-12-30T15:51:18.000Z"><meta property="article:tag" content="Java"><meta property="article:tag" content="æ¡†æ¶"><meta property="article:tag" content="Spring"><meta property="article:tag" content="SpringBoot"><meta property="article:tag" content="äº‹åŠ¡"><meta property="article:published_time" content="2022-09-22T07:46:49.000Z"><meta property="article:modified_time" content="2024-12-30T15:51:18.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Spring ä¹‹äº‹åŠ¡","image":["https://raw.githubusercontent.com/dunwu/images/master/snap/20220922073737.png","https://raw.githubusercontent.com/dunwu/images/master/snap/20220927093737.png","https://raw.githubusercontent.com/dunwu/images/master/snap/20220928114544.png","https://raw.githubusercontent.com/dunwu/images/master/snap/20220928115243.png","https://raw.githubusercontent.com/dunwu/images/master/snap/20200805171418.png"],"datePublished":"2022-09-22T07:46:49.000Z","dateModified":"2024-12-30T15:51:18.000Z","author":[{"@type":"Person","name":"xuyong","url":"https://github.com/coder-xuyong"}]}</script><script>
      // console.log(666)
      </script><link rel="icon" href="logo.png"><title>Spring ä¹‹äº‹åŠ¡ | coder-xuyong</title><meta name="description" content="Spring ä¹‹äº‹åŠ¡ Spring é’ˆå¯¹ Java Transaction API (JTA)ã€JDBCã€Hibernate å’Œ Java Persistence API(JPA) ç­‰äº‹åŠ¡ APIï¼Œå®ç°äº†ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ï¼Œè€Œ Spring çš„å£°æ˜å¼äº‹åŠ¡åŠŸèƒ½æ›´æ˜¯æä¾›äº†æå…¶æ–¹ä¾¿çš„äº‹åŠ¡é…ç½®æ–¹å¼ï¼Œé…åˆ Spring Boot çš„è‡ªåŠ¨é…ç½®ï¼Œå¤§å¤šæ•° Spring B...">
    <link rel="preload" href="/blog/assets/style-CPuF4MPT.css" as="style"><link rel="stylesheet" href="/blog/assets/style-CPuF4MPT.css">
    <link rel="modulepreload" href="/blog/assets/app-Ou5sDjBQ.js"><link rel="modulepreload" href="/blog/assets/index.html-pbXyieBv.js"><link rel="modulepreload" href="/blog/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/blog/assets/index.html-DTPLGb0L.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-BlbrAhpI.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DPEhPawd.js" as="script"><link rel="prefetch" href="/blog/assets/disable.html-DhT5a7EY.js" as="script"><link rel="prefetch" href="/blog/assets/encrypt.html-D6CLYdgC.js" as="script"><link rel="prefetch" href="/blog/assets/layout.html-DXEOcgQC.js" as="script"><link rel="prefetch" href="/blog/assets/markdown.html-CWkTC_Aa.js" as="script"><link rel="prefetch" href="/blog/assets/page.html-RQnFamwX.js" as="script"><link rel="prefetch" href="/blog/assets/é¡µé¢é…ç½®ä½¿ç”¨è¯´æ˜.html-DlNf4xcw.js" as="script"><link rel="prefetch" href="/blog/assets/idea.html-ChKM5EJk.js" as="script"><link rel="prefetch" href="/blog/assets/linux.html-VulclQHu.js" as="script"><link rel="prefetch" href="/blog/assets/linuxWork.html-D0_d9uMM.js" as="script"><link rel="prefetch" href="/blog/assets/DDL.html-CIrdIpu3.js" as="script"><link rel="prefetch" href="/blog/assets/DML_DQL.html-DyYlAUmx.js" as="script"><link rel="prefetch" href="/blog/assets/mysqlä¸»ä».html-oNx2D-mC.js" as="script"><link rel="prefetch" href="/blog/assets/mysqlBug.html-CDcK_4go.js" as="script"><link rel="prefetch" href="/blog/assets/mysqldump.html-x1XHF-vu.js" as="script"><link rel="prefetch" href="/blog/assets/mysqlå­˜å‚¨è¿‡ç¨‹.html-C7vCyvuV.js" as="script"><link rel="prefetch" href="/blog/assets/mysqlå®‰è£….html-C9bMHZl0.js" as="script"><link rel="prefetch" href="/blog/assets/mysqlå¸¸è§é”™è¯¯.html-HLoxfkSX.js" as="script"><link rel="prefetch" href="/blog/assets/mysqlæ•°æ®æ ¼å¼.html-DIIFaQfM.js" as="script"><link rel="prefetch" href="/blog/assets/mysqlçº¦æŸ.html-DNyJxhF6.js" as="script"><link rel="prefetch" href="/blog/assets/mysqlè‡ªå®šä¹‰å‡½æ•°.html-DwGuhvt8.js" as="script"><link rel="prefetch" href="/blog/assets/mysqlè§¦å‘å™¨.html-CRYiOlB5.js" as="script"><link rel="prefetch" href="/blog/assets/ftp.html-C3FljduL.js" as="script"><link rel="prefetch" href="/blog/assets/internet.html-B1oyUqpc.js" as="script"><link rel="prefetch" href="/blog/assets/redis å­¦ä¹ ç¬”è®°ä¹‹å®æˆ˜ç¯‡.html-R7k-4Ha-.js" as="script"><link rel="prefetch" href="/blog/assets/redis å­¦ä¹ ç¬”è®°ä¹‹å¿«é€Ÿå…¥é—¨.html-BcnwoARJ.js" as="script"><link rel="prefetch" href="/blog/assets/redisBUG.html-lawzLl-J.js" as="script"><link rel="prefetch" href="/blog/assets/shell.html-CNSlLwgn.js" as="script"><link rel="prefetch" href="/blog/assets/shellWork.html-B02RtA4p.js" as="script"><link rel="prefetch" href="/blog/assets/blogTutorial.html-Daqh78jU.js" as="script"><link rel="prefetch" href="/blog/assets/workcondition.html-CiMfm_qs.js" as="script"><link rel="prefetch" href="/blog/assets/1.object-oriented-programming.html-fN_StLdR.js" as="script"><link rel="prefetch" href="/blog/assets/2.three-features.html-D2yUsxro.js" as="script"><link rel="prefetch" href="/blog/assets/3.java-basic.html-DS_SN_-g.js" as="script"><link rel="prefetch" href="/blog/assets/4.collection.html-Co5r4nj2.js" as="script"><link rel="prefetch" href="/blog/assets/comparator.html-DDSg0sKY.js" as="script"><link rel="prefetch" href="/blog/assets/ioStream.html-BTKe5kC9.js" as="script"><link rel="prefetch" href="/blog/assets/java8Stream.html-D0PFuaju.js" as="script"><link rel="prefetch" href="/blog/assets/jottings.html-D4Fs2KLI.js" as="script"><link rel="prefetch" href="/blog/assets/multithreading.html-ClAStW7O.js" as="script"><link rel="prefetch" href="/blog/assets/regularExpression.html-DAhrRjJu.js" as="script"><link rel="prefetch" href="/blog/assets/bug.html-DbjMV9ef.js" as="script"><link rel="prefetch" href="/blog/assets/docx4j.html-Clmk40wb.js" as="script"><link rel="prefetch" href="/blog/assets/log.html-CyMH5aXb.js" as="script"><link rel="prefetch" href="/blog/assets/maven.html-BMB8kGbB.js" as="script"><link rel="prefetch" href="/blog/assets/modbus.html-CVx1xmAd.js" as="script"><link rel="prefetch" href="/blog/assets/mybatis.html-C1MVUZLf.js" as="script"><link rel="prefetch" href="/blog/assets/netty.html-BDAmE9Ta.js" as="script"><link rel="prefetch" href="/blog/assets/Netty01-nio.html-DYqiBsQA.js" as="script"><link rel="prefetch" href="/blog/assets/Netty02-å…¥é—¨.html-BDuoCjjV.js" as="script"><link rel="prefetch" href="/blog/assets/Netty03-è¿›é˜¶.html-D8OSK_4_.js" as="script"><link rel="prefetch" href="/blog/assets/Netty04-ä¼˜åŒ–ä¸æºç .html-CWgrEdTV.js" as="script"><link rel="prefetch" href="/blog/assets/spring.html-CDewtPZK.js" as="script"><link rel="prefetch" href="/blog/assets/springé¢è¯•é¢˜.html-DTuucRog.js" as="script"><link rel="prefetch" href="/blog/assets/workcondition.html-DeF-Cm8S.js" as="script"><link rel="prefetch" href="/blog/assets/HTTP_Tomcat_Servlet.html-BdX1asRP.js" as="script"><link rel="prefetch" href="/blog/assets/Request_Response.html-_4cHdsI9.js" as="script"><link rel="prefetch" href="/blog/assets/jdbc.html-BOL6uP-r.js" as="script"><link rel="prefetch" href="/blog/assets/djangoWork.html-BkN-MppZ.js" as="script"><link rel="prefetch" href="/blog/assets/01-JavaåŸºç¡€è¯­æ³•.html-Cl0_BOK9.js" as="script"><link rel="prefetch" href="/blog/assets/02-JavaåŸºç¡€è¯­æ³•.html-Dp0gtx6R.js" as="script"><link rel="prefetch" href="/blog/assets/03ç¬”è®°.html-3XoUk_k8.js" as="script"><link rel="prefetch" href="/blog/assets/day04-æµç¨‹æ§åˆ¶è¯­å¥.html-hYRqa1q3.js" as="script"><link rel="prefetch" href="/blog/assets/å¾ªç¯é«˜çº§.html-DWPivrRP.js" as="script"><link rel="prefetch" href="/blog/assets/æ•°ç»„.html-CbqrC71A.js" as="script"><link rel="prefetch" href="/blog/assets/æ–¹æ³•.html-BO79xAQt.js" as="script"><link rel="prefetch" href="/blog/assets/ç»¼åˆç»ƒä¹ .html-D3pVDcRM.js" as="script"><link rel="prefetch" href="/blog/assets/å¸¸ç”¨API.html-3ZE4zhnO.js" as="script"><link rel="prefetch" href="/blog/assets/é¢å‘å¯¹è±¡.html-C7OdzHpb.js" as="script"><link rel="prefetch" href="/blog/assets/æ‰©å±•ï¼šé”®ç›˜å½•å…¥ç¬”è®°.html-BGnmfkqQ.js" as="script"><link rel="prefetch" href="/blog/assets/é¢å‘å¯¹è±¡ç»¼åˆè®­ç»ƒç»¼åˆç»ƒä¹ .html-wse4-nnO.js" as="script"><link rel="prefetch" href="/blog/assets/ArrayList_å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ.html-ix99PHde.js" as="script"><link rel="prefetch" href="/blog/assets/day13é¢å‘å¯¹è±¡è¿›é˜¶.html-DeUuPBxL.js" as="script"><link rel="prefetch" href="/blog/assets/å¤šæ€.html-DsBR-00u.js" as="script"><link rel="prefetch" href="/blog/assets/day15ç¬”è®°.html-D5U_5614.js" as="script"><link rel="prefetch" href="/blog/assets/day16-é¢å‘å¯¹è±¡ç»¼åˆç»ƒä¹ ï¼ˆä¸Šï¼‰.html-CgjlK7Xt.js" as="script"><link rel="prefetch" href="/blog/assets/day17-é¢å‘å¯¹è±¡ç»¼åˆç»ƒä¹ ï¼ˆä¸‹ï¼‰.html-TJVEmLBs.js" as="script"><link rel="prefetch" href="/blog/assets/API.html-DR_uvbnK.js" as="script"><link rel="prefetch" href="/blog/assets/æ­£åˆ™è¡¨è¾¾å¼.html-BNZ24MxG.js" as="script"><link rel="prefetch" href="/blog/assets/API.html-Dem5qoyg.js" as="script"><link rel="prefetch" href="/blog/assets/ç®—æ³•.html-pWKiH1iE.js" as="script"><link rel="prefetch" href="/blog/assets/é›†åˆ01.html-C1IeXvHd.js" as="script"><link rel="prefetch" href="/blog/assets/é›†åˆ02.html-J50_89HY.js" as="script"><link rel="prefetch" href="/blog/assets/é›†åˆ03.html-3uuJ-RMy.js" as="script"><link rel="prefetch" href="/blog/assets/å¯å˜å‚æ•°_ç»¼åˆç»ƒä¹ .html-BsQMwb5K.js" as="script"><link rel="prefetch" href="/blog/assets/streamæµå’Œæ–¹æ³•å¼•ç”¨.html-DAtgPMeL.js" as="script"><link rel="prefetch" href="/blog/assets/IO(å¼‚å¸¸_File_ç»¼åˆæ¡ˆä¾‹ï¼‰.html-DFGshS3G.js" as="script"><link rel="prefetch" href="/blog/assets/IOæµï¼ˆå­—èŠ‚æµ_å­—ç¬¦æµï¼‰.html-hG7X_tPZ.js" as="script"><link rel="prefetch" href="/blog/assets/IOæµï¼ˆå…¶ä»–æµï¼‰.html-BBHvm09E.js" as="script"><link rel="prefetch" href="/blog/assets/å¤šçº¿ç¨‹01.html-D1W8PYea.js" as="script"><link rel="prefetch" href="/blog/assets/å¤šçº¿ç¨‹02.html-CrWuRKWJ.js" as="script"><link rel="prefetch" href="/blog/assets/ç½‘ç»œç¼–ç¨‹.html-DreZHHCd.js" as="script"><link rel="prefetch" href="/blog/assets/åå°„_åŠ¨æ€ä»£ç†.html-BYfFM2iH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C-AhR74R.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DCTxPwDx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C4G7VCpD.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-VyBoTYtB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DjVOL9SV.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CsvTokUP.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D2QCv05M.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-NoHPmgHJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DklPz6Np.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D_6Q2sYa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Dr6yoA-V.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CGsP1tZT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B1TZ19wP.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DYrSv9tg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ZawZpzRr.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a0Qh4nJZ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BcF-k-qz.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cuPoCL9G.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-yfuoMIiC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-yMZckupU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B3gwJMUk.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CSxH7kyX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B7Kdos99.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C4FQ50E_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DGf8NMuH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CG5czbor.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CpwdSaFP.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BtHMOAk8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B3qPxaIL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BjipPuxu.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D2SGKQ6y.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CJQ8vDta.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DHtaQqqM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-qe-Q6CYv.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BDiSaCa8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ukZAn-mR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BQm0IETa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C-26_SJp.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Gq3zwCG5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-hNVbMoTe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-pfQ-wrtP.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BjG3fwRy.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CjdcU-Om.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cwo-Pck7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B2cqHaJO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DB0KzuYv.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CThDWVsH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BtxnOUs7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DO1ApkwX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CME1ORzq.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D5HN_8m0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BdJTvt4E.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BXr-4v8k.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CJXI4-Mc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-RGAJR1dv.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-qrQrbjSE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CWT4NoqJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2Dl_HAID.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CE2G04F4.js" as="script"><link rel="prefetch" href="/blog/assets/day02-JavaScript-Vue.html-D3wfFBaG.js" as="script"><link rel="prefetch" href="/blog/assets/day03_Vue_Element.html-ZEyAjA8-.js" as="script"><link rel="prefetch" href="/blog/assets/æ•°æ®åº“-MySQL-01.html-BPYztd-l.js" as="script"><link rel="prefetch" href="/blog/assets/æ•°æ®åº“-MySQL-02.html-DFBeAd2i.js" as="script"><link rel="prefetch" href="/blog/assets/Mybatis.html-BsWV6wus.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBootWebæ¡ˆä¾‹-1.html-DzAG58HG.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBootWebæ¡ˆä¾‹-2.html-DxmRsbFY.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBootWebç™»å½•è®¤è¯.html-CuRYmNmd.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBootWeb AOP.html-DQM5QDmU.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBootåŸç†ç¯‡.html-QK4OSwjE.js" as="script"><link rel="prefetch" href="/blog/assets/Mavené«˜çº§.html-BUHUnvUC.js" as="script"><link rel="prefetch" href="/blog/assets/logæ—¥å¿—.html-CeDqPihw.js" as="script"><link rel="prefetch" href="/blog/assets/ç±»åŠ è½½å™¨.html-70RGwx1y.js" as="script"><link rel="prefetch" href="/blog/assets/xml.html-BqLn6oaD.js" as="script"><link rel="prefetch" href="/blog/assets/å•å…ƒæµ‹è¯•.html-CDnaQsbr.js" as="script"><link rel="prefetch" href="/blog/assets/æ³¨è§£.html-w8u-a7Wl.js" as="script"><link rel="prefetch" href="/blog/assets/Maven.html-CXPCJByi.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBootWebå…¥é—¨.html-Cq6Zd300.js" as="script"><link rel="prefetch" href="/blog/assets/æ•°æ®åº“-MySQL-03.html-rBbF8n5j.js" as="script"><link rel="prefetch" href="/blog/assets/Mybatiså…¥é—¨.html-BEKKZE7Z.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-CmokSSMG.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CWROP6E1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DbDta1js.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DoLXYJ6s.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D7rRHboF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DS28eGcJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BvGIEV0d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-pW845Bfz.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Czz66vcB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9byfytNK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D6C-m1GN.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BquFKfrv.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CIzA7T3o.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DaNt-UlM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CBcNN9CX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C-DfcU5_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BhhxGTvd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DYGo0h9x.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-V5wHsXKH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D1nkamOF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Nlarn3kn.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cx8BgihJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BqPuxAa6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DrkCY76_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CL0Ar9dS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DmiKSoE7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-zAUXkyho.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CaISDNwJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DhotH1iG.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CP90iPie.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DWvY_d49.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BXB9vi-0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Dwy1OShm.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B8Air7TC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CjJcqs1l.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DwZLgOR_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1WIpIpno.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KLGJHtwc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0Ocr4T5z.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-neOZWcH3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Djy1zmoL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DFWBb9oE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BimOD4Xb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CmZdpd_N.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CnX2AmAX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CviekVq7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C9os7ZmV.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BLyjXgnX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-kLqaN5m_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CVGb0eM4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-utqixsC-.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DGP-2kxz.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DGCV8PoD.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C0PlxDgL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8tVsjEGo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-JVpmf3xp.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D3x0kW6M.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KBhOsAES.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CN5CSw89.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ZV1Nk_YC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ByYRHcnY.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C7Kjnoq1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cq9F1Nn3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-igMDYTTd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DjgMK1E6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-lSgVhcxi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cq1bk8_w.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bdhj1qk6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B0gM_XTO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D39fdkSH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Ef6cb7Mc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Dc_eOgGb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BuOrQBvk.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DjxS7vmA.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B9yMBt-l.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B5yGKIOE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BPsaTEGW.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CeIsvXsF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-vlECWg4p.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cho7V0R9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ah0YLx4j.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-wtnh1LGq.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BOf6GDIK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DcvrrpdY.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BVTw6zkG.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CIr9SFw4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-nIxrSyez.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dH1-KYC8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DB1DcBXY.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-wtnh1LGq.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DVlTOnuj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dH1-KYC8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C5STZOds.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BdbBabin.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EyiJZLbE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B7mpPPEu.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-QtcmbhJQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CEc5hRlV.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B1sKLfeN.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CGnIk-4m.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cq8xReT5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ByQXRcrr.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-kMDnbqHQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D0snv75Z.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-rzjZtVyM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cg5M_l8O.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Gz5oPaJc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BakzLt_s.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Du9NVqIQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D6hzTyCL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D9d6nLTX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DjqmUKm_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Dc5nnvds.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-T4xf4qCx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DEkNKsxM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C5Q4UpMO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Ud5-qunw.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CEEpmfpF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DTAo7KsB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CAGj3TS0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cy8SBS0K.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BDV4WfYd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-82FdOf0t.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-I4pVG6KS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DWndJYd2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-clC25eYE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EQotKTQe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ROpUBaUJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CUtZ5rGd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B1XMNy8c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BUeQlzoi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CEjBpkuE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dVwqvzeI.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D9d6nLTX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DSZNZlR3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DjqmUKm_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Dc5nnvds.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D6a4DPpG.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B9hsOhPC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-afVp_VlG.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C1I5Wt0Q.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-zk1x-XTa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-W-hrEZR-.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DJnlgkeC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BV-2zb6S.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-uab_p6pg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BxtOTQFA.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cu_aWpWI.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CEjBpkuE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CBzpCUq3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D54IE_r8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Dk9Yat9e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-I4pVG6KS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BIkTLt4x.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DnA-eufH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-T4xf4qCx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DwCqJxaA.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Dv18o4Ly.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bsp9qJNM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C4D0OTlO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D0YiCi3y.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CVqrCYLE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D7suQBIk.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CS1Vxl37.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DxQ1vos_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-tQt4pkc6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Z-W5zWWQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BGXFzNpj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CGhY02uE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CFN0RqDj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BoH9Lw5N.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CAXMDTte.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D9m63Pve.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BQtjirTh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CWFReyuX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-xmkNk_DG.js" as="script"><link rel="prefetch" href="/blog/assets/photoswipe.esm-CMg0yb1C.js" as="script"><link rel="prefetch" href="/blog/assets/setupDevtools-7MC2TMWH-BSCX1sgm.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/blog/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="/blog/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">coder-xuyong</span></a><!--]--></div><div class="vp-navbar-center"><!----></div><div class="vp-navbar-end"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/posts/java/basic/" aria-label="java åŸºç¡€"><!--[--><img class="icon" src="https://www.java.com/favicon.ico" alt no-view style=""><!--]-->java åŸºç¡€<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/posts/java/spring/" aria-label="spring"><!--[--><img class="icon" src="https://docs.spring.io/spring-boot/_/img/favicon.ico" alt no-view style=""><!--]-->spring<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ¡†æ¶"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-book" style=""></span>æ¡†æ¶<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">netty</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/blog/posts/java/netty/Netty01-nio.html" aria-label="NIO åŸºç¡€"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->NIO åŸºç¡€<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/blog/posts/java/netty/Netty02-%E5%85%A5%E9%97%A8.html" aria-label="Netty å…¥é—¨"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->Netty å…¥é—¨<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/blog/posts/java/netty/Netty03-%E8%BF%9B%E9%98%B6.html" aria-label="Netty è¿›é˜¶"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->Netty è¿›é˜¶<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/blog/posts/java/netty/Netty04-%E4%BC%98%E5%8C%96%E4%B8%8E%E6%BA%90%E7%A0%81.html" aria-label="ä¼˜åŒ–ä¸æºç "><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->ä¼˜åŒ–ä¸æºç <!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">spring</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/blog/posts/java/spring/spring.html" aria-label="spring å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->spring å­¦ä¹ ç¬”è®°<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/posts/java/spring/" aria-label="spring"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-glasses" style=""></span><!--]-->spring<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="https://theme-hope.vuejs.press/zh/" aria-label="V2 æ–‡æ¡£" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->V2 æ–‡æ¡£<!----></a></div></nav><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/coder-xuyong/blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/blog/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/intro.html" aria-label="ä»‹ç»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span><!--]-->ä»‹ç»é¡µ<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">æ–‡ç« </span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/blog/posts/%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E.html" aria-label="é¡µé¢é…ç½®ä½¿ç”¨è¯´æ˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-file" style=""></span><!--]-->é¡µé¢é…ç½®ä½¿ç”¨è¯´æ˜<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Idea</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Java</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Basic</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Bug</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Dependence</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Netty</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Spring</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">10 Springå®‰å…¨</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring IO</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring Web</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring å…¶ä»–</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/posts/java/spring/spring.html" aria-label="spring å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->spring å­¦ä¹ ç¬”è®°<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Spring æ•°æ®ç¯‡</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/blog/pages/1b774c/" aria-label="Spring ä¹‹æ•°æ®æº"><!---->Spring ä¹‹æ•°æ®æº<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/pages/cf19fd/" aria-label="Spring ä¹‹ JDBC"><!---->Spring ä¹‹ JDBC<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/blog/pages/128c54/" aria-label="Spring ä¹‹äº‹åŠ¡"><!---->Spring ä¹‹äº‹åŠ¡<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/pages/a03d7b/" aria-label="Spring ä¹‹ JPA"><!---->Spring ä¹‹ JPA<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/pages/88219e/" aria-label="Spring é›†æˆ Mybatis"><!---->Spring é›†æˆ Mybatis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/pages/191cdb/" aria-label="Spring Data ç»¼åˆ"><!---->Spring Data ç»¼åˆ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/pages/65e4a2/" aria-label="Spring è®¿é—® Redis"><!---->Spring è®¿é—® Redis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/pages/db2a41/" aria-label="Spring è®¿é—® MongoDB"><!---->Spring è®¿é—® MongoDB<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/pages/fac14c/" aria-label="Spring è®¿é—® Elasticsearch"><!---->Spring è®¿é—® Elasticsearch<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring æ ¸å¿ƒ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring ç»¼è¿°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring é›†æˆ</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/posts/java/spring/spring%E9%9D%A2%E8%AF%95%E9%A2%98.html" aria-label="springé¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->springé¢è¯•é¢˜<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Springboot</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Web</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Linux</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Mysql</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Network</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Python</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Shell</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Vuepress</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Windows</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Spring ä¹‹äº‹åŠ¡</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/coder-xuyong" target="_blank" rel="noopener noreferrer">xuyong</a></span><span property="author" content="xuyong"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2022å¹´9æœˆ22æ—¥</span><meta property="datePublished" content="2022-09-22T07:46:49.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 43 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT43M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8 clickable" role="navigation">Java</span><span class="page-category-item color6 clickable" role="navigation">æ¡†æ¶</span><span class="page-category-item color1 clickable" role="navigation">Spring</span><span class="page-category-item color3 clickable" role="navigation">Springæ•°æ®</span><!--]--><meta property="articleSection" content="Java,æ¡†æ¶,Spring,Springæ•°æ®"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">Java</span><span class="page-tag-item color6 clickable" role="navigation">æ¡†æ¶</span><span class="page-tag-item color1 clickable" role="navigation">Spring</span><span class="page-tag-item color2 clickable" role="navigation">SpringBoot</span><span class="page-tag-item color4 clickable" role="navigation">äº‹åŠ¡</span><!--]--><meta property="keywords" content="Java,æ¡†æ¶,Spring,SpringBoot,äº‹åŠ¡"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<!----><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç†è§£äº‹åŠ¡">ç†è§£äº‹åŠ¡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹åŠ¡çš„ç‰¹æ€§">äº‹åŠ¡çš„ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…¨å±€äº‹åŠ¡">å…¨å±€äº‹åŠ¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æœ¬åœ°äº‹åŠ¡">æœ¬åœ°äº‹åŠ¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-å¯¹äº‹åŠ¡çš„æ”¯æŒ">Spring å¯¹äº‹åŠ¡çš„æ”¯æŒ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-äº‹åŠ¡çš„ä¼˜ç‚¹">Spring äº‹åŠ¡çš„ä¼˜ç‚¹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ ¸å¿ƒ-api">æ ¸å¿ƒ API</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transactionmanager">TransactionManager</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transactiondefinition">TransactionDefinition</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transactionstatus">TransactionStatus</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transactiontemplate">TransactionTemplate</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å£°æ˜å¼äº‹åŠ¡ç®¡ç†">å£°æ˜å¼äº‹åŠ¡ç®¡ç†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„å®ç°">Spring å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„å®ç°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å£°æ˜å¼äº‹åŠ¡ç¤ºä¾‹">å£°æ˜å¼äº‹åŠ¡ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å›æ»šä¸€ä¸ªå£°æ˜æ€§äº‹åŠ¡">å›æ»šä¸€ä¸ªå£°æ˜æ€§äº‹åŠ¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä¸åŒçš„-bean-é…ç½®ä¸åŒçš„äº‹åŠ¡è¯­ä¹‰">ä¸ºä¸åŒçš„ Bean é…ç½®ä¸åŒçš„äº‹åŠ¡è¯­ä¹‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tx-advice-é…ç½®">&lt;tx:advice/&gt; é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-transactional-æ³¨è§£">ä½¿ç”¨ @Transactional æ³¨è§£</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#jdbc-å¼‚å¸¸æŠ½è±¡">JDBC å¼‚å¸¸æŠ½è±¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#spring-äº‹åŠ¡æœ€ä½³å®è·µ">Spring äº‹åŠ¡æœ€ä½³å®è·µ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-äº‹åŠ¡æœªç”Ÿæ•ˆ">Spring äº‹åŠ¡æœªç”Ÿæ•ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹åŠ¡è™½ç„¶ç”Ÿæ•ˆä½†æœªå›æ»š">äº‹åŠ¡è™½ç„¶ç”Ÿæ•ˆä½†æœªå›æ»š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»†åŒ–äº‹åŠ¡ä¼ æ’­æ–¹å¼">ç»†åŒ–äº‹åŠ¡ä¼ æ’­æ–¹å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><h1 id="spring-ä¹‹äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#spring-ä¹‹äº‹åŠ¡"><span>Spring ä¹‹äº‹åŠ¡</span></a></h1><p>Spring é’ˆå¯¹ Java Transaction API (JTA)ã€JDBCã€Hibernate å’Œ Java Persistence API(JPA) ç­‰äº‹åŠ¡ APIï¼Œå®ç°äº†ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ï¼Œè€Œ Spring çš„å£°æ˜å¼äº‹åŠ¡åŠŸèƒ½æ›´æ˜¯æä¾›äº†æå…¶æ–¹ä¾¿çš„äº‹åŠ¡é…ç½®æ–¹å¼ï¼Œé…åˆ Spring Boot çš„è‡ªåŠ¨é…ç½®ï¼Œå¤§å¤šæ•° Spring Boot é¡¹ç›®åªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ ‡è®° <code>@Transactional</code> æ³¨è§£ï¼Œå³å¯ä¸€é”®å¼€å¯æ–¹æ³•çš„äº‹åŠ¡æ€§é…ç½®ã€‚</p><h2 id="ç†è§£äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#ç†è§£äº‹åŠ¡"><span>ç†è§£äº‹åŠ¡</span></a></h2><p>åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œå…¨æœ‰æˆ–å…¨æ— çš„æ“ä½œè¢«ç§°ä¸º<strong>äº‹åŠ¡ï¼ˆtransactionï¼‰</strong>ã€‚äº‹åŠ¡å…è®¸ä½ å°†å‡ ä¸ªæ“ä½œç»„åˆæˆä¸€ä¸ªè¦ä¹ˆå…¨éƒ¨å‘ç”Ÿè¦ä¹ˆå…¨éƒ¨ä¸å‘ç”Ÿçš„å·¥ä½œå•å…ƒã€‚ä¼ ç»Ÿä¸Š Java EE å¼€å‘å¯¹äº‹åŠ¡ç®¡ç†æœ‰ä¸¤ç§é€‰æ‹©ï¼š<strong>å…¨å±€äº‹åŠ¡</strong>æˆ–<strong>æœ¬åœ°äº‹åŠ¡</strong>ï¼Œä¸¤è€…éƒ½æœ‰å¾ˆå¤§çš„å±€é™æ€§ã€‚</p><h3 id="äº‹åŠ¡çš„ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡çš„ç‰¹æ€§"><span>äº‹åŠ¡çš„ç‰¹æ€§</span></a></h3><p>äº‹åŠ¡åº”è¯¥å…·æœ‰ 4 ä¸ªå±æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚è¿™å››ä¸ªå±æ€§é€šå¸¸ç§°ä¸º <strong>ACID</strong>ã€‚</p><ul><li><strong>åŸå­æ€§ï¼ˆAtomicï¼‰</strong>ï¼šä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…æ‹¬çš„è¯¸æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšã€‚</li><li><strong>ä¸€è‡´æ€§ï¼ˆConsistentï¼‰</strong>ï¼šäº‹åŠ¡å¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ä¸€è‡´æ€§ä¸åŸå­æ€§æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚</li><li><strong>éš”ç¦»æ€§ï¼ˆIsolatedï¼‰</strong>ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</li><li><strong>æŒä¹…æ€§ï¼ˆDurableï¼‰</strong>ï¼šæŒä¹…æ€§ä¹Ÿç§°æ°¸ä¹…æ€§ï¼ˆpermanenceï¼‰ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚æ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li></ul><h3 id="å…¨å±€äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#å…¨å±€äº‹åŠ¡"><span>å…¨å±€äº‹åŠ¡</span></a></h3><p>å…¨å±€äº‹åŠ¡å…è®¸æ‚¨ä½¿ç”¨å¤šä¸ªäº‹åŠ¡èµ„æºï¼Œé€šå¸¸æ˜¯å…³ç³»æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—ã€‚åº”ç”¨æœåŠ¡å™¨é€šè¿‡ JTA ç®¡ç†å…¨å±€äº‹åŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªç¹ççš„ APIï¼ˆéƒ¨åˆ†åŸå› åœ¨äºå…¶å¼‚å¸¸æ¨¡å‹ï¼‰ã€‚æ­¤å¤–ï¼ŒJTA UserTransaction é€šå¸¸éœ€è¦æ¥è‡ª JNDIï¼Œè¿™æ„å‘³ç€æ‚¨è¿˜éœ€è¦ä½¿ç”¨ JNDI æ‰èƒ½ä½¿ç”¨ JTAã€‚å…¨å±€äº‹åŠ¡çš„ä½¿ç”¨é™åˆ¶äº†åº”ç”¨ç¨‹åºä»£ç çš„ä»»ä½•æ½œåœ¨é‡ç”¨ï¼Œå› ä¸º JTA é€šå¸¸ä»…åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨ç¯å¢ƒä¸­å¯ç”¨ã€‚</p><p>ä»¥å‰ï¼Œä½¿ç”¨å…¨å±€äº‹åŠ¡çš„é¦–é€‰æ–¹å¼æ˜¯é€šè¿‡ EJB CMTï¼ˆå®¹å™¨ç®¡ç†äº‹åŠ¡ï¼‰ã€‚ CMT æ˜¯ä¸€ç§å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆä¸åŒäºç¨‹åºåŒ–äº‹åŠ¡ç®¡ç†ï¼‰ã€‚ EJB CMT æ¶ˆé™¤äº†å¯¹ä¸äº‹åŠ¡ç›¸å…³çš„ JNDI æŸ¥æ‰¾çš„éœ€è¦ï¼Œå°½ç®¡ä½¿ç”¨ EJB æœ¬èº«å°±éœ€è¦ä½¿ç”¨ JNDIã€‚å®ƒæ¶ˆé™¤äº†å¤§éƒ¨åˆ†ï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰ç¼–å†™ Java ä»£ç æ¥æ§åˆ¶äº‹åŠ¡çš„éœ€è¦ã€‚å…¶æ˜æ˜¾çš„ç¼ºç‚¹æ˜¯ CMT ä¸ JTA å’Œåº”ç”¨ç¨‹åºæœåŠ¡å™¨ç¯å¢ƒç›¸å…³è”ã€‚æ­¤å¤–ï¼Œå®ƒä»…åœ¨é€‰æ‹©åœ¨ EJB ä¸­å®ç°ä¸šåŠ¡é€»è¾‘ï¼ˆæˆ–è‡³å°‘åœ¨äº‹åŠ¡æ€§ EJB å¤–è§‚ä¹‹åï¼‰æ—¶æ‰å¯ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒEJB çš„è´Ÿé¢å½±å“æ˜¯å¦‚æ­¤ä¹‹å¤§ï¼Œä»¥è‡³äºè¿™ä¸æ˜¯ä¸€ä¸ªæœ‰å¸å¼•åŠ›çš„æè®®ï¼Œå°¤å…¶æ˜¯åœ¨é¢å¯¹å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„å¼•äººæ³¨ç›®çš„æ›¿ä»£æ–¹æ¡ˆæ—¶ã€‚</p><h3 id="æœ¬åœ°äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#æœ¬åœ°äº‹åŠ¡"><span>æœ¬åœ°äº‹åŠ¡</span></a></h3><p>æœ¬åœ°äº‹åŠ¡æ˜¯æŒ‡å®šèµ„æºçš„ï¼Œä¾‹å¦‚ä¸ JDBC è¿æ¥å…³è”çš„äº‹åŠ¡ã€‚æœ¬åœ°äº‹åŠ¡å¯èƒ½æ›´å®¹æ˜“ä½¿ç”¨ï¼Œä½†æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼šå®ƒä»¬ä¸èƒ½è·¨å¤šä¸ªäº‹åŠ¡èµ„æºå·¥ä½œã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ JDBC è¿æ¥ç®¡ç†äº‹åŠ¡çš„ä»£ç ä¸èƒ½åœ¨å…¨å±€ JTA äº‹åŠ¡ä¸­è¿è¡Œã€‚å› ä¸ºåº”ç”¨æœåŠ¡å™¨ä¸å‚ä¸äº‹åŠ¡ç®¡ç†ï¼Œå®ƒä¸èƒ½ç¡®ä¿è·¨å¤šä¸ªèµ„æºçš„æ­£ç¡®æ€§ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºä½¿ç”¨å•ä¸ªäº‹åŠ¡èµ„æºã€‚ï¼‰ã€‚å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯æœ¬åœ°äº‹åŠ¡å¯¹ç¼–ç¨‹æ¨¡å‹å…·æœ‰ä¾µå…¥æ€§ã€‚</p><h3 id="spring-å¯¹äº‹åŠ¡çš„æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#spring-å¯¹äº‹åŠ¡çš„æ”¯æŒ"><span>Spring å¯¹äº‹åŠ¡çš„æ”¯æŒ</span></a></h3><p>Spring é€šè¿‡å›è°ƒæœºåˆ¶å°†å®é™…çš„äº‹åŠ¡å®ç°ä»äº‹åŠ¡æ€§çš„ä»£ç ä¸­æŠ½è±¡å‡ºæ¥ã€‚Spring è§£å†³äº†å…¨å±€å’Œæœ¬åœ°äº‹åŠ¡çš„ç¼ºç‚¹ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜åœ¨ä»»ä½•ç¯å¢ƒä¸­ä½¿ç”¨ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ã€‚æ‚¨åªéœ€ç¼–å†™ä¸€æ¬¡ä»£ç ï¼Œå®ƒå°±å¯ä»¥ä»ä¸åŒç¯å¢ƒä¸­çš„ä¸åŒäº‹åŠ¡ç®¡ç†ç­–ç•¥ä¸­å—ç›Šã€‚Spring æä¾›äº†å¯¹ç¼–ç å¼å’Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„æ”¯æŒï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ¨èä½¿ç”¨å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚</p><ul><li>ç¼–ç å¼äº‹åŠ¡å…è®¸ç”¨æˆ·åœ¨ä»£ç ä¸­ç²¾ç¡®å®šä¹‰äº‹åŠ¡çš„è¾¹ç•Œ</li><li>å£°æ˜å¼äº‹åŠ¡ï¼ˆåŸºäº AOPï¼‰æœ‰åŠ©äºç”¨æˆ·å°†æ“ä½œä¸äº‹åŠ¡è§„åˆ™è¿›è¡Œè§£è€¦</li></ul><p>é€šè¿‡ç¨‹åºåŒ–äº‹åŠ¡ç®¡ç†ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ Spring äº‹åŠ¡æŠ½è±¡ï¼Œå®ƒå¯ä»¥åœ¨ä»»ä½•åº•å±‚äº‹åŠ¡åŸºç¡€ä¸Šè¿è¡Œã€‚ä½¿ç”¨é¦–é€‰çš„å£°æ˜æ€§æ¨¡å‹ï¼Œå¼€å‘äººå‘˜é€šå¸¸ç¼–å†™å¾ˆå°‘æˆ–æ ¹æœ¬ä¸ç¼–å†™ä¸äº‹åŠ¡ç®¡ç†ç›¸å…³çš„ä»£ç ï¼Œå› æ­¤ä¸ä¾èµ– Spring äº‹åŠ¡ API æˆ–ä»»ä½•å…¶ä»–äº‹åŠ¡ APIã€‚</p><h3 id="spring-äº‹åŠ¡çš„ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#spring-äº‹åŠ¡çš„ä¼˜ç‚¹"><span>Spring äº‹åŠ¡çš„ä¼˜ç‚¹</span></a></h3><p>Spring æ¡†æ¶ä¸ºäº‹åŠ¡ç®¡ç†æä¾›äº†ä¸€è‡´çš„æŠ½è±¡ï¼Œå…·æœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p><ul><li>è·¨ä¸åŒäº‹åŠ¡ API çš„ä¸€è‡´ç¼–ç¨‹æ¨¡å‹ï¼Œä¾‹å¦‚ Java Transaction API (JTA)ã€JDBCã€Hibernate å’Œ Java Persistence API (JPA)ã€‚</li><li>æ”¯æŒå£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚</li><li>ç”¨äºç¼–ç¨‹äº‹åŠ¡ç®¡ç†çš„ API æ¯”å¤æ‚äº‹åŠ¡ APIï¼ˆå¦‚ JTAï¼‰æ›´ç®€å•ã€‚</li><li>ä¸ Spring çš„æ•°æ®è®¿é—®æŠ½è±¡å®Œç¾é›†æˆã€‚</li></ul><h2 id="æ ¸å¿ƒ-api" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒ-api"><span>æ ¸å¿ƒ API</span></a></h2><h3 id="transactionmanager" tabindex="-1"><a class="header-anchor" href="#transactionmanager"><span>TransactionManager</span></a></h3><p>Spring äº‹åŠ¡æŠ½è±¡çš„å…³é”®æ˜¯äº‹åŠ¡ç­–ç•¥çš„æ¦‚å¿µã€‚äº‹åŠ¡ç­–ç•¥ç”± <code>TransactionManager</code> å®šä¹‰ï¼Œç‰¹åˆ«æ˜¯ç”¨äºå‘½ä»¤å¼äº‹åŠ¡ç®¡ç†çš„ <code>org.springframework.transaction.PlatformTransactionManager</code> æ¥å£å’Œç”¨äºå“åº”å¼äº‹åŠ¡ç®¡ç†çš„ <code>org.springframework.transaction.ReactiveTransactionManager</code> æ¥å£ã€‚</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20220922073737.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="platformtransactionmanager" tabindex="-1"><a class="header-anchor" href="#platformtransactionmanager"><span>PlatformTransactionManager</span></a></h4><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº† <code>PlatformTransactionManager</code> API çš„å®šä¹‰ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> PlatformTransactionManager</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionManager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    TransactionStatus</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getTransaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TransactionDefinition</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> definition</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> commit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TransactionStatus</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> rollback</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TransactionStatus</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>PlatformTransactionManager</code> æ˜¯ä¸€ä¸ª SPI æ¥å£ï¼Œæ‰€ä»¥ä½¿ç”¨è€…å¯ä»¥ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨å®ƒã€‚å› ä¸º <code>PlatformTransactionManager</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®éœ€è¦è½»æ¾åœ° MOCK æˆ–å­˜æ ¹ã€‚å®ƒä¸ä¾èµ–äºæŸ¥æ‰¾ç­–ç•¥ï¼Œä¾‹å¦‚ JNDIã€‚ <code>PlatformTransactionManager</code> å®ç°çš„å®šä¹‰ä¸ Spring IoC å®¹å™¨ä¸­çš„ä»»ä½•å…¶ä»–å¯¹è±¡ï¼ˆæˆ– beanï¼‰ä¸€æ ·ã€‚ä»…æ­¤ä¸€é¡¹ä¼˜åŠ¿å°±ä½¿ Spring äº‹åŠ¡æˆä¸ºæœ‰ä»·å€¼çš„æŠ½è±¡ï¼Œå³ä½¿æ‚¨ä½¿ç”¨ JTA ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸ç›´æ¥ä½¿ç”¨ JTA ç›¸æ¯”ï¼Œæ‚¨å¯ä»¥æ›´è½»æ¾åœ°æµ‹è¯•äº‹åŠ¡ä»£ç ã€‚</p><p>åŒæ ·ï¼Œä¸ºäº†ä¸ Spring çš„ç†å¿µä¿æŒä¸€è‡´ï¼Œä»»ä½• <code>PlatformTransactionManager</code> æ¥å£çš„æ–¹æ³•å¯ä»¥æŠ›å‡ºçš„ <code>TransactionException</code> éƒ½æ˜¯æœªç»æ£€æŸ¥çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ‰©å±•äº† <code>java.lang.RuntimeException</code> ç±»ï¼‰ã€‚äº‹åŠ¡æ¶æ„æ•…éšœå‡ ä¹æ€»æ˜¯è‡´å‘½çš„ã€‚æå°‘æ•°æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä»äº‹åŠ¡å¤±è´¥ä¸­æ¢å¤ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©æ•è·å’Œå¤„ç† <code>TransactionException</code>ã€‚é‡ç‚¹æ˜¯å¼€å‘äººå‘˜å¹¶éè¢«è¿«è¿™æ ·åšã€‚</p><p><code>getTransaction(..)</code> æ–¹æ³•æ ¹æ® <code>TransactionDefinition</code> å‚æ•°è¿”å›ä¸€ä¸ª <code>TransactionStatus</code> å¯¹è±¡ã€‚å¦‚æœå½“å‰è°ƒç”¨å †æ ˆä¸­å­˜åœ¨åŒ¹é…çš„äº‹åŠ¡ï¼Œåˆ™è¿”å›çš„ <code>TransactionStatus</code> å¯èƒ½è¡¨ç¤ºæ–°äº‹åŠ¡æˆ–å¯ä»¥è¡¨ç¤ºç°æœ‰äº‹åŠ¡ã€‚åä¸€ç§æƒ…å†µçš„å«ä¹‰æ˜¯ï¼Œä¸ Java EE äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸€æ ·ï¼Œ<code>TransactionStatus</code> ä¸æ‰§è¡Œçº¿ç¨‹ç›¸å…³è”ã€‚</p><p>ä»ä»¥ä¸Šå¯ä»¥çœ‹å‡ºï¼Œå…·ä½“çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶å¯¹ Spring æ¥è¯´æ˜¯é€æ˜çš„ï¼Œå®ƒå¹¶ä¸å…³å¿ƒé‚£äº›ï¼Œé‚£äº›æ˜¯å¯¹åº”å„ä¸ªå¹³å°éœ€è¦å…³å¿ƒçš„ï¼Œæ‰€ä»¥ Spring äº‹åŠ¡ç®¡ç†çš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯ä¸ºä¸åŒçš„äº‹åŠ¡ API æä¾›ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå¦‚ JTAã€JDBCã€Hibernateã€JPAã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»å„ä¸ªå¹³å°æ¡†æ¶å®ç°äº‹åŠ¡ç®¡ç†çš„æœºåˆ¶ã€‚</p><h4 id="jdbc-äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#jdbc-äº‹åŠ¡"><span>JDBC äº‹åŠ¡</span></a></h4><p>å¦‚æœåº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨ JDBC æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œ<code>DataSourceTransactionManager</code> ä¼šä¸ºä½ å¤„ç†äº‹åŠ¡è¾¹ç•Œã€‚ä¸ºäº†ä½¿ç”¨ <code>DataSourceTransactionManager</code>ï¼Œä½ éœ€è¦ä½¿ç”¨å¦‚ä¸‹çš„ XML å°†å…¶è£…é…åˆ°åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡å®šä¹‰ä¸­ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;transactionManager&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…ä¸Šï¼Œ<code>DataSourceTransactionManager</code> æ˜¯é€šè¿‡è°ƒç”¨ <code>java.sql.Connection</code> æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œåè€…æ˜¯é€šè¿‡ <code>DataSource</code> è·å–åˆ°çš„ã€‚é€šè¿‡è°ƒç”¨è¿æ¥çš„ <code>commit()</code> æ–¹æ³•æ¥æäº¤äº‹åŠ¡ï¼ŒåŒæ ·ï¼Œäº‹åŠ¡å¤±è´¥åˆ™é€šè¿‡è°ƒç”¨ <code>rollback()</code> æ–¹æ³•è¿›è¡Œå›æ»šã€‚</p><h4 id="hibernate-äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#hibernate-äº‹åŠ¡"><span>Hibernate äº‹åŠ¡</span></a></h4><p>å¦‚æœåº”ç”¨ç¨‹åºçš„æŒä¹…åŒ–æ˜¯é€šè¿‡ Hibernate å®ç°çš„ï¼Œé‚£ä¹ˆä½ éœ€è¦ä½¿ç”¨ <code>HibernateTransactionManager</code>ã€‚å¯¹äº Hibernate3ï¼Œéœ€è¦åœ¨ Spring ä¸Šä¸‹æ–‡å®šä¹‰ä¸­æ·»åŠ å¦‚ä¸‹çš„ <code>bean</code> å£°æ˜ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;transactionManager&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework.orm.hibernate3.HibernateTransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sessionFactory&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sessionFactory&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>sessionFactory</code> å±æ€§éœ€è¦è£…é…ä¸€ä¸ª Hibernate çš„ session å·¥å‚ï¼Œ<code>HibernateTransactionManager</code> çš„å®ç°ç»†èŠ‚æ˜¯å®ƒå°†äº‹åŠ¡ç®¡ç†çš„èŒè´£å§”æ‰˜ç»™ <code>org.hibernate.Transaction</code> å¯¹è±¡ï¼Œè€Œåè€…æ˜¯ä» Hibernate Session ä¸­è·å–åˆ°çš„ã€‚å½“äº‹åŠ¡æˆåŠŸå®Œæˆæ—¶ï¼Œ<code>HibernateTransactionManager</code> å°†ä¼šè°ƒç”¨ <code>Transaction</code> å¯¹è±¡çš„ <code>commit()</code> æ–¹æ³•ï¼Œåä¹‹ï¼Œå°†ä¼šè°ƒç”¨ <code>rollback()</code> æ–¹æ³•ã€‚</p><h4 id="java-æŒä¹…åŒ–-api-äº‹åŠ¡-jpa" tabindex="-1"><a class="header-anchor" href="#java-æŒä¹…åŒ–-api-äº‹åŠ¡-jpa"><span>Java æŒä¹…åŒ– API äº‹åŠ¡ï¼ˆJPAï¼‰</span></a></h4><p>Hibernate å¤šå¹´æ¥ä¸€ç›´æ˜¯äº‹å®ä¸Šçš„ Java æŒä¹…åŒ–æ ‡å‡†ï¼Œä½†æ˜¯ç°åœ¨ Java æŒä¹…åŒ– API ä½œä¸ºçœŸæ­£çš„ Java æŒä¹…åŒ–æ ‡å‡†è¿›å…¥å¤§å®¶çš„è§†é‡ã€‚å¦‚æœä½ è®¡åˆ’ä½¿ç”¨ JPA çš„è¯ï¼Œé‚£ä½ éœ€è¦ä½¿ç”¨ Spring çš„ <code>JpaTransactionManager</code> æ¥å¤„ç†äº‹åŠ¡ã€‚ä½ éœ€è¦åœ¨ Spring ä¸­è¿™æ ·é…ç½® <code>JpaTransactionManager</code>ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;transactionManager&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sessionFactory&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sessionFactory&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>JpaTransactionManager</code> åªéœ€è¦è£…é…ä¸€ä¸ª JPA å®ä½“ç®¡ç†å·¥å‚ï¼ˆ<code>javax.persistence.EntityManagerFactory</code> æ¥å£çš„ä»»æ„å®ç°ï¼‰ã€‚<code>JpaTransactionManager</code> å°†ä¸ç”±å·¥å‚æ‰€äº§ç”Ÿçš„ JPA EntityManager åˆä½œæ¥æ„å»ºäº‹åŠ¡ã€‚</p><h4 id="java-åŸç”Ÿ-api-äº‹åŠ¡-jta" tabindex="-1"><a class="header-anchor" href="#java-åŸç”Ÿ-api-äº‹åŠ¡-jta"><span>Java åŸç”Ÿ API äº‹åŠ¡ï¼ˆJTAï¼‰</span></a></h4><p>å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ä»¥ä¸Šæ‰€è¿°çš„äº‹åŠ¡ç®¡ç†ï¼Œæˆ–è€…æ˜¯è·¨è¶Šäº†å¤šä¸ªäº‹åŠ¡ç®¡ç†æºï¼ˆæ¯”å¦‚ä¸¤ä¸ªæˆ–è€…æ˜¯å¤šä¸ªä¸åŒçš„æ•°æ®æºï¼‰ï¼Œä½ å°±éœ€è¦ä½¿ç”¨<code>JtaTransactionManager</code>ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;transactionManager&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;transactionManagerName&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java:/TransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>JtaTransactionManager</code> å°†äº‹åŠ¡ç®¡ç†çš„è´£ä»»å§”æ‰˜ç»™ <code>javax.transaction.UserTransaction</code> å’Œ <code>javax.transaction.TransactionManager</code> å¯¹è±¡ï¼Œå…¶ä¸­äº‹åŠ¡æˆåŠŸå®Œæˆé€šè¿‡ <code>UserTransaction.commit()</code> æ–¹æ³•æäº¤ï¼Œäº‹åŠ¡å¤±è´¥é€šè¿‡ <code>UserTransaction.rollback()</code> æ–¹æ³•å›æ»šã€‚</p><h4 id="reactivetransactionmanager" tabindex="-1"><a class="header-anchor" href="#reactivetransactionmanager"><span>ReactiveTransactionManager</span></a></h4><p>Spring è¿˜ä¸ºä½¿ç”¨å“åº”å¼ç±»å‹æˆ– Kotlin åç¨‹çš„å“åº”å¼åº”ç”¨ç¨‹åºæä¾›äº†äº‹åŠ¡ç®¡ç†æŠ½è±¡ã€‚ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº† <code>org.springframework.transaction.ReactiveTransactionManager</code> å®šä¹‰çš„äº‹åŠ¡ç­–ç•¥ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ReactiveTransactionManager</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionManager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Mono</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ReactiveTransaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getReactiveTransaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TransactionDefinition</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> definition</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Mono</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> commit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ReactiveTransaction</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Mono</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> rollback</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ReactiveTransaction</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å“åº”å¼äº‹åŠ¡ç®¡ç†å™¨ä¸»è¦æ˜¯ä¸€ä¸ª SPIï¼Œæ‰€ä»¥ä½¿ç”¨è€…å¯ä»¥ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨å®ƒã€‚å› ä¸º <code>ReactiveTransactionManager</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®éœ€è¦è½»æ¾åœ° MOCK æˆ–å­˜æ ¹ã€‚</p><h3 id="transactiondefinition" tabindex="-1"><a class="header-anchor" href="#transactiondefinition"><span>TransactionDefinition</span></a></h3><p><code>PlatformTransactionManager</code> é€šè¿‡ <code>getTransaction(TransactionDefinition definition)</code> æ–¹æ³•æ¥å¾—åˆ°äº‹åŠ¡ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢çš„å‚æ•°æ˜¯ <code>TransactionDefinition</code> ç±»ï¼Œè¿™ä¸ªç±»å°±å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„äº‹åŠ¡å±æ€§ã€‚äº‹åŠ¡å±æ€§å¯ä»¥ç†è§£æˆäº‹åŠ¡çš„ä¸€äº›åŸºæœ¬é…ç½®ï¼Œæè¿°äº†äº‹åŠ¡ç­–ç•¥å¦‚ä½•åº”ç”¨åˆ°æ–¹æ³•ä¸Šã€‚</p><p><code>TransactionDefinition</code> æ¥å£å†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionDefinition</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getPropagationBehavior</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // è¿”å›äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getIsolationLevel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // è¿”å›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡ç®¡ç†å™¨æ ¹æ®å®ƒæ¥æ§åˆ¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°æœ¬äº‹åŠ¡å†…çš„å“ªäº›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // è¿”å›äº‹åŠ¡å¿…é¡»åœ¨å¤šå°‘ç§’å†…å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> isReadOnly</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // äº‹åŠ¡æ˜¯å¦åªè¯»ï¼Œäº‹åŠ¡ç®¡ç†å™¨èƒ½å¤Ÿæ ¹æ®è¿™ä¸ªè¿”å›å€¼è¿›è¡Œä¼˜åŒ–ï¼Œç¡®ä¿äº‹åŠ¡æ˜¯åªè¯»çš„</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥å‘ç° <code>TransactionDefinition</code> æ­£å¥½ç”¨æ¥å®šä¹‰äº‹åŠ¡å±æ€§ï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹å„ä¸ªäº‹åŠ¡å±æ€§ã€‚</p><h4 id="ä¼ æ’­è¡Œä¸º" tabindex="-1"><a class="header-anchor" href="#ä¼ æ’­è¡Œä¸º"><span>ä¼ æ’­è¡Œä¸º</span></a></h4><p>äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼ˆpropagation behaviorï¼‰æ˜¯æŒ‡ï¼šå½“äº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šäº‹åŠ¡åº”è¯¥å¦‚ä½•ä¼ æ’­ã€‚ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œã€‚Spring å®šä¹‰äº†ä¸ƒç§ä¼ æ’­è¡Œä¸ºï¼š</p><table><thead><tr><th>ä¼ æ’­è¡Œä¸º</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>PROPAGATION_REQUIRED</code></td><td>è¡¨ç¤ºå½“å‰æ–¹æ³•å¿…é¡»è¿è¡Œåœ¨äº‹åŠ¡ä¸­ã€‚å¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨ï¼Œæ–¹æ³•å°†ä¼šåœ¨è¯¥äº‹åŠ¡ä¸­è¿è¡Œã€‚å¦åˆ™ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„äº‹åŠ¡</td></tr><tr><td><code>PROPAGATION_SUPPORTS</code></td><td>è¡¨ç¤ºå½“å‰æ–¹æ³•ä¸éœ€è¦äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨å½“å‰äº‹åŠ¡çš„è¯ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¼šåœ¨è¿™ä¸ªäº‹åŠ¡ä¸­è¿è¡Œ</td></tr><tr><td><code>PROPAGATION_MANDATORY</code></td><td>è¡¨ç¤ºè¯¥æ–¹æ³•å¿…é¡»åœ¨äº‹åŠ¡ä¸­è¿è¡Œï¼Œå¦‚æœå½“å‰äº‹åŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</td></tr><tr><td><code>PROPAGATION_REQUIRED_NEW</code></td><td>è¡¨ç¤ºå½“å‰æ–¹æ³•å¿…é¡»è¿è¡Œåœ¨å®ƒè‡ªå·±çš„äº‹åŠ¡ä¸­ã€‚ä¸€ä¸ªæ–°çš„äº‹åŠ¡å°†è¢«å¯åŠ¨ã€‚å¦‚æœå­˜åœ¨å½“å‰äº‹åŠ¡ï¼Œåœ¨è¯¥æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œå½“å‰äº‹åŠ¡ä¼šè¢«æŒ‚èµ·ã€‚å¦‚æœä½¿ç”¨ JTATransactionManager çš„è¯ï¼Œåˆ™éœ€è¦è®¿é—® TransactionManager</td></tr><tr><td><code>PROPAGATION_NOT_SUPPORTED</code></td><td>è¡¨ç¤ºè¯¥æ–¹æ³•ä¸åº”è¯¥è¿è¡Œåœ¨äº‹åŠ¡ä¸­ã€‚å¦‚æœå­˜åœ¨å½“å‰äº‹åŠ¡ï¼Œåœ¨è¯¥æ–¹æ³•è¿è¡ŒæœŸé—´ï¼Œå½“å‰äº‹åŠ¡å°†è¢«æŒ‚èµ·ã€‚å¦‚æœä½¿ç”¨ JTATransactionManager çš„è¯ï¼Œåˆ™éœ€è¦è®¿é—® TransactionManager</td></tr><tr><td><code>PROPAGATION_NEVER</code></td><td>è¡¨ç¤ºå½“å‰æ–¹æ³•ä¸åº”è¯¥è¿è¡Œåœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­ã€‚å¦‚æœå½“å‰æ­£æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿è¡Œï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</td></tr><tr><td><code>PROPAGATION_NESTED</code></td><td>è¡¨ç¤ºå¦‚æœå½“å‰å·²ç»å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å°†ä¼šåœ¨åµŒå¥—äº‹åŠ¡ä¸­è¿è¡Œã€‚åµŒå¥—çš„äº‹åŠ¡å¯ä»¥ç‹¬ç«‹äºå½“å‰äº‹åŠ¡è¿›è¡Œå•ç‹¬åœ°æäº¤æˆ–å›æ»šã€‚å¦‚æœå½“å‰äº‹åŠ¡ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå…¶è¡Œä¸ºä¸ PROPAGATION_REQUIRED ä¸€æ ·ã€‚æ³¨æ„å„å‚å•†å¯¹è¿™ç§ä¼ æ’­è¡Œä¸ºçš„æ”¯æŒæ˜¯æœ‰æ‰€å·®å¼‚çš„ã€‚å¯ä»¥å‚è€ƒèµ„æºç®¡ç†å™¨çš„æ–‡æ¡£æ¥ç¡®è®¤å®ƒä»¬æ˜¯å¦æ”¯æŒåµŒå¥—äº‹åŠ¡</td></tr></tbody></table><p><em>æ³¨ï¼šä»¥ä¸‹å…·ä½“è®²è§£ä¼ æ’­è¡Œä¸ºçš„å†…å®¹å‚è€ƒè‡ª Spring äº‹åŠ¡æœºåˆ¶è¯¦è§£</em></p><ol><li>PROPAGATION_REQUIRED å¦‚æœå­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œåˆ™æ”¯æŒå½“å‰äº‹åŠ¡ã€‚å¦‚æœæ²¡æœ‰äº‹åŠ¡åˆ™å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</li></ol><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// äº‹åŠ¡å±æ€§ PROPAGATION_REQUIRED</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">methodA {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    â€¦â€¦</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    methodB</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    â€¦â€¦</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// äº‹åŠ¡å±æ€§ PROPAGATION_REQUIRED</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">methodB {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">   â€¦â€¦</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ spring å£°æ˜å¼äº‹åŠ¡ï¼Œspring ä½¿ç”¨ AOP æ¥æ”¯æŒå£°æ˜å¼äº‹åŠ¡ï¼Œä¼šæ ¹æ®äº‹åŠ¡å±æ€§ï¼Œè‡ªåŠ¨åœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰å†³å®šæ˜¯å¦å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œä¹‹åå†³å®šäº‹åŠ¡æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚</p><p>å•ç‹¬è°ƒç”¨ methodB æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">main {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    metodB</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›¸å½“äº</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">Main {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Connection</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> con</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        con </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getConnection</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setAutoCommit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        //æ–¹æ³•è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        methodB</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        //æäº¤äº‹åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">commit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ex) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        //å›æ»šäº‹åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rollback</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        //é‡Šæ”¾èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        closeCon</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring ä¿è¯åœ¨ methodB æ–¹æ³•ä¸­æ‰€æœ‰çš„è°ƒç”¨éƒ½è·å¾—åˆ°ä¸€ä¸ªç›¸åŒçš„è¿æ¥ã€‚åœ¨è°ƒç”¨ methodB æ—¶ï¼Œæ²¡æœ‰ä¸€ä¸ªå­˜åœ¨çš„äº‹åŠ¡ï¼Œæ‰€ä»¥è·å¾—ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå¼€å¯äº†ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚<br> å•ç‹¬è°ƒç”¨ MethodA æ—¶ï¼Œåœ¨ MethodA å†…åˆä¼šè°ƒç”¨ MethodB.</p><p>æ‰§è¡Œæ•ˆæœç›¸å½“äºï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">main{</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Connection</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> con </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        con </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getConnection</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        methodA</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">commit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RuntimeException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rollback</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        closeCon</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨ MethodA æ—¶ï¼Œç¯å¢ƒä¸­æ²¡æœ‰äº‹åŠ¡ï¼Œæ‰€ä»¥å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡.å½“åœ¨ MethodA ä¸­è°ƒç”¨ MethodB æ—¶ï¼Œç¯å¢ƒä¸­å·²ç»æœ‰äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰€ä»¥ methodB å°±åŠ å…¥å½“å‰äº‹åŠ¡ã€‚</p><ol start="2"><li><code>PROPAGATION_SUPPORTS</code> å¦‚æœå­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œæ”¯æŒå½“å‰äº‹åŠ¡ã€‚å¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™éäº‹åŠ¡çš„æ‰§è¡Œã€‚ä½†æ˜¯å¯¹äºäº‹åŠ¡åŒæ­¥çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œ<code>PROPAGATION_SUPPORTS</code> ä¸ä¸ä½¿ç”¨äº‹åŠ¡æœ‰å°‘è®¸ä¸åŒã€‚</li></ol><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//äº‹åŠ¡å±æ€§ PROPAGATION_REQUIRED</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">methodA</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  methodB</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//äº‹åŠ¡å±æ€§ PROPAGATION_SUPPORTS</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">methodB</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  â€¦â€¦</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å•çº¯çš„è°ƒç”¨ methodB æ—¶ï¼ŒmethodB æ–¹æ³•æ˜¯éäº‹åŠ¡çš„æ‰§è¡Œçš„ã€‚å½“è°ƒç”¨ methdA æ—¶,methodB åˆ™åŠ å…¥äº† methodA çš„äº‹åŠ¡ä¸­,äº‹åŠ¡åœ°æ‰§è¡Œã€‚</p><ol start="3"><li><code>PROPAGATION_MANDATORY</code> å¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œæ”¯æŒå½“å‰äº‹åŠ¡ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªæ´»åŠ¨çš„äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//äº‹åŠ¡å±æ€§ PROPAGATION_REQUIRED</span></span>
<span class="line"><span>methodA(){</span></span>
<span class="line"><span>    methodB();</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//äº‹åŠ¡å±æ€§ PROPAGATION_MANDATORY</span></span>
<span class="line"><span>    methodB(){</span></span>
<span class="line"><span>    â€¦â€¦</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“å•ç‹¬è°ƒç”¨ methodB æ—¶ï¼Œå› ä¸ºå½“å‰æ²¡æœ‰ä¸€ä¸ªæ´»åŠ¨çš„äº‹åŠ¡ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ throw new IllegalTransactionStateException(â€œTransaction propagation â€˜mandatoryâ€™ but no existing transaction foundâ€);å½“è°ƒç”¨ methodA æ—¶ï¼ŒmethodB åˆ™åŠ å…¥åˆ° methodA çš„äº‹åŠ¡ä¸­ï¼Œäº‹åŠ¡åœ°æ‰§è¡Œã€‚</p><ol start="4"><li><code>PROPAGATION_REQUIRES_NEW</code> æ€»æ˜¯å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡å·²ç»å­˜åœ¨ï¼Œåˆ™å°†è¿™ä¸ªå­˜åœ¨çš„äº‹åŠ¡æŒ‚èµ·ã€‚</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//äº‹åŠ¡å±æ€§ PROPAGATION_REQUIRED</span></span>
<span class="line"><span>methodA(){</span></span>
<span class="line"><span>    doSomeThingA();</span></span>
<span class="line"><span>    methodB();</span></span>
<span class="line"><span>    doSomeThingB();</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//äº‹åŠ¡å±æ€§ PROPAGATION_REQUIRES_NEW</span></span>
<span class="line"><span>methodB(){</span></span>
<span class="line"><span>    â€¦â€¦</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨ A æ–¹æ³•ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>main(){</span></span>
<span class="line"><span>    methodA();</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›¸å½“äº</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>main(){</span></span>
<span class="line"><span>    TransactionManager tm = null;</span></span>
<span class="line"><span>    try{</span></span>
<span class="line"><span>        //è·å¾—ä¸€ä¸ªJTAäº‹åŠ¡ç®¡ç†å™¨</span></span>
<span class="line"><span>        tm = getTransactionManager();</span></span>
<span class="line"><span>        tm.begin();//å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡</span></span>
<span class="line"><span>        Transaction ts1 = tm.getTransaction();</span></span>
<span class="line"><span>        doSomeThing();</span></span>
<span class="line"><span>        tm.suspend();//æŒ‚èµ·å½“å‰äº‹åŠ¡</span></span>
<span class="line"><span>        try{</span></span>
<span class="line"><span>            tm.begin();//é‡æ–°å¼€å¯ç¬¬äºŒä¸ªäº‹åŠ¡</span></span>
<span class="line"><span>            Transaction ts2 = tm.getTransaction();</span></span>
<span class="line"><span>            methodB();</span></span>
<span class="line"><span>            ts2.commit();//æäº¤ç¬¬äºŒä¸ªäº‹åŠ¡</span></span>
<span class="line"><span>        } Catch(RunTimeException ex) {</span></span>
<span class="line"><span>            ts2.rollback();//å›æ»šç¬¬äºŒä¸ªäº‹åŠ¡</span></span>
<span class="line"><span>        } finally {</span></span>
<span class="line"><span>            //é‡Šæ”¾èµ„æº</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        //methodBæ‰§è¡Œå®Œåï¼Œæ¢å¤ç¬¬ä¸€ä¸ªäº‹åŠ¡</span></span>
<span class="line"><span>        tm.resume(ts1);</span></span>
<span class="line"><span>        doSomeThingB();</span></span>
<span class="line"><span>        ts1.commit();//æäº¤ç¬¬ä¸€ä¸ªäº‹åŠ¡</span></span>
<span class="line"><span>    } catch(RunTimeException ex) {</span></span>
<span class="line"><span>        ts1.rollback();//å›æ»šç¬¬ä¸€ä¸ªäº‹åŠ¡</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        //é‡Šæ”¾èµ„æº</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘æŠŠ ts1 ç§°ä¸ºå¤–å±‚äº‹åŠ¡ï¼Œts2 ç§°ä¸ºå†…å±‚äº‹åŠ¡ã€‚ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œts2 ä¸ ts1 æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ï¼Œäº’ä¸ç›¸å¹²ã€‚Ts2 æ˜¯å¦æˆåŠŸå¹¶ä¸ä¾èµ–äº ts1ã€‚å¦‚æœ methodA æ–¹æ³•åœ¨è°ƒç”¨ methodB æ–¹æ³•åçš„ doSomeThingB æ–¹æ³•å¤±è´¥äº†ï¼Œè€Œ methodB æ–¹æ³•æ‰€åšçš„ç»“æœä¾ç„¶è¢«æäº¤ã€‚è€Œé™¤äº† methodB ä¹‹å¤–çš„å…¶å®ƒä»£ç å¯¼è‡´çš„ç»“æœå´è¢«å›æ»šäº†ã€‚ä½¿ç”¨ PROPAGATION_REQUIRES_NEW,éœ€è¦ä½¿ç”¨ JtaTransactionManager ä½œä¸ºäº‹åŠ¡ç®¡ç†å™¨ã€‚</p><ol start="5"><li><code>PROPAGATION_NOT_SUPPORTED</code> æ€»æ˜¯éäº‹åŠ¡åœ°æ‰§è¡Œï¼Œå¹¶æŒ‚èµ·ä»»ä½•å­˜åœ¨çš„äº‹åŠ¡ã€‚ä½¿ç”¨ PROPAGATION_NOT_SUPPORTED,ä¹Ÿéœ€è¦ä½¿ç”¨ JtaTransactionManager ä½œä¸ºäº‹åŠ¡ç®¡ç†å™¨ã€‚ï¼ˆä»£ç ç¤ºä¾‹åŒä¸Šï¼Œå¯åŒç†æ¨å‡ºï¼‰</li><li>PROPAGATION_NEVER æ€»æ˜¯éäº‹åŠ¡åœ°æ‰§è¡Œï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªæ´»åŠ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>PROPAGATION_NESTED å¦‚æœä¸€ä¸ªæ´»åŠ¨çš„äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™è¿è¡Œåœ¨ä¸€ä¸ªåµŒå¥—çš„äº‹åŠ¡ä¸­. å¦‚æœæ²¡æœ‰æ´»åŠ¨äº‹åŠ¡, åˆ™æŒ‰ TransactionDefinition.PROPAGATION_REQUIRED å±æ€§æ‰§è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªåµŒå¥—äº‹åŠ¡,ä½¿ç”¨ JDBC 3.0 é©±åŠ¨æ—¶,ä»…ä»…æ”¯æŒ DataSourceTransactionManager ä½œä¸ºäº‹åŠ¡ç®¡ç†å™¨ã€‚éœ€è¦ JDBC é©±åŠ¨çš„ java.sql.Savepoint ç±»ã€‚æœ‰ä¸€äº› JTA çš„äº‹åŠ¡ç®¡ç†å™¨å®ç°å¯èƒ½ä¹Ÿæä¾›äº†åŒæ ·çš„åŠŸèƒ½ã€‚ä½¿ç”¨ PROPAGATION_NESTEDï¼Œè¿˜éœ€è¦æŠŠ PlatformTransactionManager çš„ nestedTransactionAllowed å±æ€§è®¾ä¸º true;è€Œ nestedTransactionAllowed å±æ€§å€¼é»˜è®¤ä¸º falseã€‚</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//äº‹åŠ¡å±æ€§ PROPAGATION_REQUIRED</span></span>
<span class="line"><span>methodA(){</span></span>
<span class="line"><span>    doSomeThingA();</span></span>
<span class="line"><span>    methodB();</span></span>
<span class="line"><span>    doSomeThingB();</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//äº‹åŠ¡å±æ€§ PROPAGATION_NESTED</span></span>
<span class="line"><span>methodB(){</span></span>
<span class="line"><span>    â€¦â€¦</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœå•ç‹¬è°ƒç”¨ methodB æ–¹æ³•ï¼Œåˆ™æŒ‰ REQUIRED å±æ€§æ‰§è¡Œã€‚å¦‚æœè°ƒç”¨ methodA æ–¹æ³•ï¼Œç›¸å½“äºä¸‹é¢çš„æ•ˆæœï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>main(){</span></span>
<span class="line"><span>    Connection con = null;</span></span>
<span class="line"><span>    Savepoint savepoint = null;</span></span>
<span class="line"><span>    try{</span></span>
<span class="line"><span>        con = getConnection();</span></span>
<span class="line"><span>        con.setAutoCommit(false);</span></span>
<span class="line"><span>        doSomeThingA();</span></span>
<span class="line"><span>        savepoint = con2.setSavepoint();</span></span>
<span class="line"><span>        try{</span></span>
<span class="line"><span>            methodB();</span></span>
<span class="line"><span>        } catch(RuntimeException ex) {</span></span>
<span class="line"><span>            con.rollback(savepoint);</span></span>
<span class="line"><span>        } finally {</span></span>
<span class="line"><span>            //é‡Šæ”¾èµ„æº</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        doSomeThingB();</span></span>
<span class="line"><span>        con.commit();</span></span>
<span class="line"><span>    } catch(RuntimeException ex) {</span></span>
<span class="line"><span>        con.rollback();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        //é‡Šæ”¾èµ„æº</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ methodB æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œè°ƒç”¨ setSavepoint æ–¹æ³•ï¼Œä¿å­˜å½“å‰çš„çŠ¶æ€åˆ° savepointã€‚å¦‚æœ methodB æ–¹æ³•è°ƒç”¨å¤±è´¥ï¼Œåˆ™æ¢å¤åˆ°ä¹‹å‰ä¿å­˜çš„çŠ¶æ€ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ—¶çš„äº‹åŠ¡å¹¶æ²¡æœ‰è¿›è¡Œæäº¤ï¼Œå¦‚æœåç»­çš„ä»£ç (doSomeThingB()æ–¹æ³•)è°ƒç”¨å¤±è´¥ï¼Œåˆ™å›æ»šåŒ…æ‹¬ methodB æ–¹æ³•çš„æ‰€æœ‰æ“ä½œã€‚</p><p>åµŒå¥—äº‹åŠ¡ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µå°±æ˜¯å†…å±‚äº‹åŠ¡ä¾èµ–äºå¤–å±‚äº‹åŠ¡ã€‚å¤–å±‚äº‹åŠ¡å¤±è´¥æ—¶ï¼Œä¼šå›æ»šå†…å±‚äº‹åŠ¡æ‰€åšçš„åŠ¨ä½œã€‚è€Œå†…å±‚äº‹åŠ¡æ“ä½œå¤±è´¥å¹¶ä¸ä¼šå¼•èµ·å¤–å±‚äº‹åŠ¡çš„å›æ»šã€‚</p><p>PROPAGATION_NESTED ä¸ PROPAGATION_REQUIRES_NEW çš„åŒºåˆ«:å®ƒä»¬éå¸¸ç±»ä¼¼,éƒ½åƒä¸€ä¸ªåµŒå¥—äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨ä¸€ä¸ªæ´»åŠ¨çš„äº‹åŠ¡ï¼Œéƒ½ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚ä½¿ç”¨ PROPAGATION_REQUIRES_NEW æ—¶ï¼Œå†…å±‚äº‹åŠ¡ä¸å¤–å±‚äº‹åŠ¡å°±åƒä¸¤ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ä¸€æ ·ï¼Œä¸€æ—¦å†…å±‚äº‹åŠ¡è¿›è¡Œäº†æäº¤åï¼Œå¤–å±‚äº‹åŠ¡ä¸èƒ½å¯¹å…¶è¿›è¡Œå›æ»šã€‚ä¸¤ä¸ªäº‹åŠ¡äº’ä¸å½±å“ã€‚ä¸¤ä¸ªäº‹åŠ¡ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„åµŒå¥—äº‹åŠ¡ã€‚åŒæ—¶å®ƒéœ€è¦ JTA äº‹åŠ¡ç®¡ç†å™¨çš„æ”¯æŒã€‚</p><p>ä½¿ç”¨ PROPAGATION_NESTED æ—¶ï¼Œå¤–å±‚äº‹åŠ¡çš„å›æ»šå¯ä»¥å¼•èµ·å†…å±‚äº‹åŠ¡çš„å›æ»šã€‚è€Œå†…å±‚äº‹åŠ¡çš„å¼‚å¸¸å¹¶ä¸ä¼šå¯¼è‡´å¤–å±‚äº‹åŠ¡çš„å›æ»šï¼Œå®ƒæ˜¯ä¸€ä¸ªçœŸæ­£çš„åµŒå¥—äº‹åŠ¡ã€‚DataSourceTransactionManager ä½¿ç”¨ savepoint æ”¯æŒ PROPAGATION_NESTED æ—¶ï¼Œéœ€è¦ JDBC 3.0 ä»¥ä¸Šé©±åŠ¨åŠ 1.4 ä»¥ä¸Šçš„ JDK ç‰ˆæœ¬æ”¯æŒã€‚å…¶å®ƒçš„ JTA TrasactionManager å®ç°å¯èƒ½æœ‰ä¸åŒçš„æ”¯æŒæ–¹å¼ã€‚</p><p>PROPAGATION_REQUIRES_NEW å¯åŠ¨ä¸€ä¸ªæ–°çš„, ä¸ä¾èµ–äºç¯å¢ƒçš„ â€œå†…éƒ¨â€ äº‹åŠ¡. è¿™ä¸ªäº‹åŠ¡å°†è¢«å®Œå…¨ commited æˆ– rolled back è€Œä¸ä¾èµ–äºå¤–éƒ¨äº‹åŠ¡, å®ƒæ‹¥æœ‰è‡ªå·±çš„éš”ç¦»èŒƒå›´, è‡ªå·±çš„é”, ç­‰ç­‰. å½“å†…éƒ¨äº‹åŠ¡å¼€å§‹æ‰§è¡Œæ—¶, å¤–éƒ¨äº‹åŠ¡å°†è¢«æŒ‚èµ·, å†…åŠ¡äº‹åŠ¡ç»“æŸæ—¶, å¤–éƒ¨äº‹åŠ¡å°†ç»§ç»­æ‰§è¡Œã€‚</p><p>å¦ä¸€æ–¹é¢, PROPAGATION_NESTED å¼€å§‹ä¸€ä¸ª â€œåµŒå¥—çš„â€ äº‹åŠ¡, å®ƒæ˜¯å·²ç»å­˜åœ¨äº‹åŠ¡çš„ä¸€ä¸ªçœŸæ­£çš„å­äº‹åŠ¡. æ½œå¥—äº‹åŠ¡å¼€å§‹æ‰§è¡Œæ—¶, å®ƒå°†å–å¾—ä¸€ä¸ª savepoint. å¦‚æœè¿™ä¸ªåµŒå¥—äº‹åŠ¡å¤±è´¥, æˆ‘ä»¬å°†å›æ»šåˆ°æ­¤ savepoint. æ½œå¥—äº‹åŠ¡æ˜¯å¤–éƒ¨äº‹åŠ¡çš„ä¸€éƒ¨åˆ†, åªæœ‰å¤–éƒ¨äº‹åŠ¡ç»“æŸåå®ƒæ‰ä¼šè¢«æäº¤ã€‚</p><p>ç”±æ­¤å¯è§, PROPAGATION_REQUIRES_NEW å’Œ PROPAGATION_NESTED çš„æœ€å¤§åŒºåˆ«åœ¨äº, PROPAGATION_REQUIRES_NEW å®Œå…¨æ˜¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡, è€Œ PROPAGATION_NESTED åˆ™æ˜¯å¤–éƒ¨äº‹åŠ¡çš„å­äº‹åŠ¡, å¦‚æœå¤–éƒ¨äº‹åŠ¡ commit, åµŒå¥—äº‹åŠ¡ä¹Ÿä¼šè¢« commit, è¿™ä¸ªè§„åˆ™åŒæ ·é€‚ç”¨äº roll back.</p><p>PROPAGATION_REQUIRED åº”è¯¥æ˜¯æˆ‘ä»¬é¦–å…ˆçš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚å®ƒèƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬å¤§å¤šæ•°çš„äº‹åŠ¡éœ€æ±‚ã€‚</p><h4 id="éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#éš”ç¦»çº§åˆ«"><span>éš”ç¦»çº§åˆ«</span></a></h4><p>äº‹åŠ¡çš„ç¬¬äºŒä¸ªç»´åº¦å°±æ˜¯éš”ç¦»çº§åˆ«ï¼ˆisolation levelï¼‰ã€‚éš”ç¦»çº§åˆ«å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–å¹¶å‘äº‹åŠ¡å½±å“çš„ç¨‹åº¦ã€‚</p><ol><li>å¹¶å‘äº‹åŠ¡å¼•èµ·çš„é—®é¢˜</li></ol><p>åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒçš„æ•°æ®æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸‹çš„é—®é¢˜ã€‚</p><ul><li>è„è¯»ï¼ˆDirty readsï¼‰â€”â€”è„è¯»å‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æ”¹å†™ä½†å°šæœªæäº¤çš„æ•°æ®æ—¶ã€‚å¦‚æœæ”¹å†™åœ¨ç¨åè¢«å›æ»šäº†ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªäº‹åŠ¡è·å–çš„æ•°æ®å°±æ˜¯æ— æ•ˆçš„ã€‚</li><li>ä¸å¯é‡å¤è¯»ï¼ˆNonrepeatable readï¼‰â€”â€”ä¸å¯é‡å¤è¯»å‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢ä¸¤æ¬¡æˆ–ä¸¤æ¬¡ä»¥ä¸Šï¼Œä½†æ˜¯æ¯æ¬¡éƒ½å¾—åˆ°ä¸åŒçš„æ•°æ®æ—¶ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºå¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡åœ¨ä¸¤æ¬¡æŸ¥è¯¢æœŸé—´è¿›è¡Œäº†æ›´æ–°ã€‚</li><li>å¹»è¯»ï¼ˆPhantom readï¼‰â€”â€”å¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡ï¼ˆT2ï¼‰æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰å°±ä¼šå‘ç°å¤šäº†ä¸€äº›åŸæœ¬ä¸å­˜åœ¨çš„è®°å½•ã€‚</li></ul><p><strong>ä¸å¯é‡å¤è¯»ä¸å¹»è¯»çš„åŒºåˆ«</strong></p><p>ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹:<br> åŒæ ·çš„æ¡ä»¶, ä½ è¯»å–è¿‡çš„æ•°æ®, å†æ¬¡è¯»å–å‡ºæ¥å‘ç°å€¼ä¸ä¸€æ ·äº†<br> ä¾‹å¦‚ï¼šåœ¨äº‹åŠ¡ 1 ä¸­ï¼ŒMary è¯»å–äº†è‡ªå·±çš„å·¥èµ„ä¸º 1000,æ“ä½œå¹¶æ²¡æœ‰å®Œæˆ</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    con1 = getConnection();</span></span>
<span class="line"><span>    select salary from employee empId =&quot;Mary&quot;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨äº‹åŠ¡ 2 ä¸­ï¼Œè¿™æ—¶è´¢åŠ¡äººå‘˜ä¿®æ”¹äº† Mary çš„å·¥èµ„ä¸º 2000,å¹¶æäº¤äº†äº‹åŠ¡.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    con2 = getConnection();</span></span>
<span class="line"><span>    update employee set salary = 2000;</span></span>
<span class="line"><span>    con2.commit();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨äº‹åŠ¡ 1 ä¸­ï¼ŒMary å†æ¬¡è¯»å–è‡ªå·±çš„å·¥èµ„æ—¶ï¼Œå·¥èµ„å˜ä¸ºäº† 2000</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    //con1</span></span>
<span class="line"><span>    select salary from employee empId =&quot;Mary&quot;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å‰åä¸¤æ¬¡è¯»å–çš„ç»“æœå¹¶ä¸ä¸€è‡´ï¼Œå¯¼è‡´äº†ä¸å¯é‡å¤è¯»ã€‚</p><p>å¹»è¯»çš„é‡ç‚¹åœ¨äºæ–°å¢æˆ–è€…åˆ é™¤ï¼š<br> åŒæ ·çš„æ¡ä»¶, ç¬¬ 1 æ¬¡å’Œç¬¬ 2 æ¬¡è¯»å‡ºæ¥çš„è®°å½•æ•°ä¸ä¸€æ ·<br> ä¾‹å¦‚ï¼šç›®å‰å·¥èµ„ä¸º 1000 çš„å‘˜å·¥æœ‰ 10 äººã€‚äº‹åŠ¡ 1,è¯»å–æ‰€æœ‰å·¥èµ„ä¸º 1000 çš„å‘˜å·¥ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    con1 = getConnection();</span></span>
<span class="line"><span>    Select * from employee where salary =1000;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å…±è¯»å– 10 æ¡è®°å½•</p><p>è¿™æ—¶å¦ä¸€ä¸ªäº‹åŠ¡å‘ employee è¡¨æ’å…¥äº†ä¸€æ¡å‘˜å·¥è®°å½•ï¼Œå·¥èµ„ä¹Ÿä¸º 1000</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    con2 = getConnection();</span></span>
<span class="line"><span>    Insert into employee(empId,salary) values(&quot;Lili&quot;,1000);</span></span>
<span class="line"><span>    con2.commit();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>äº‹åŠ¡ 1 å†æ¬¡è¯»å–æ‰€æœ‰å·¥èµ„ä¸º 1000 çš„å‘˜å·¥</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    //con1</span></span>
<span class="line"><span>    select * from employee where salary =1000;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å…±è¯»å–åˆ°äº† 11 æ¡è®°å½•ï¼Œè¿™å°±äº§ç”Ÿäº†å¹»åƒè¯»ã€‚</p><p>ä»æ€»çš„ç»“æœæ¥çœ‹, ä¼¼ä¹ä¸å¯é‡å¤è¯»å’Œå¹»è¯»éƒ½è¡¨ç°ä¸ºä¸¤æ¬¡è¯»å–çš„ç»“æœä¸ä¸€è‡´ã€‚ä½†å¦‚æœä½ ä»æ§åˆ¶çš„è§’åº¦æ¥çœ‹, ä¸¤è€…çš„åŒºåˆ«å°±æ¯”è¾ƒå¤§ã€‚<br> å¯¹äºå‰è€…, åªéœ€è¦é”ä½æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚<br> å¯¹äºåè€…, è¦é”ä½æ»¡è¶³æ¡ä»¶åŠå…¶ç›¸è¿‘çš„è®°å½•ã€‚</p><ol start="2"><li>éš”ç¦»çº§åˆ«</li></ol><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ISOLATION_DEFAULT</td><td>ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«</td></tr><tr><td>ISOLATION_READ_UNCOMMITTED</td><td>æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»</td></tr><tr><td>ISOLATION_READ_COMMITTED</td><td>å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</td></tr><tr><td>ISOLATION_REPEATABLE_READ</td><td>å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</td></tr><tr><td>ISOLATION_SERIALIZABLE</td><td>æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ï¼Œç¡®ä¿é˜»æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ï¼Œä¹Ÿæ˜¯æœ€æ…¢çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå› ä¸ºå®ƒé€šå¸¸æ˜¯é€šè¿‡å®Œå…¨é”å®šäº‹åŠ¡ç›¸å…³çš„æ•°æ®åº“è¡¨æ¥å®ç°çš„</td></tr></tbody></table><h4 id="åªè¯»" tabindex="-1"><a class="header-anchor" href="#åªè¯»"><span>åªè¯»</span></a></h4><p>äº‹åŠ¡çš„ç¬¬ä¸‰ä¸ªç‰¹æ€§æ˜¯å®ƒæ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ã€‚å¦‚æœäº‹åŠ¡åªå¯¹åç«¯çš„æ•°æ®åº“è¿›è¡Œè¯¥æ“ä½œï¼Œæ•°æ®åº“å¯ä»¥åˆ©ç”¨äº‹åŠ¡çš„åªè¯»ç‰¹æ€§æ¥è¿›è¡Œä¸€äº›ç‰¹å®šçš„ä¼˜åŒ–ã€‚é€šè¿‡å°†äº‹åŠ¡è®¾ç½®ä¸ºåªè¯»ï¼Œä½ å°±å¯ä»¥ç»™æ•°æ®åº“ä¸€ä¸ªæœºä¼šï¼Œè®©å®ƒåº”ç”¨å®ƒè®¤ä¸ºåˆé€‚çš„ä¼˜åŒ–æªæ–½ã€‚</p><h4 id="äº‹åŠ¡è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡è¶…æ—¶"><span>äº‹åŠ¡è¶…æ—¶</span></a></h4><p>ä¸ºäº†ä½¿åº”ç”¨ç¨‹åºå¾ˆå¥½åœ°è¿è¡Œï¼Œäº‹åŠ¡ä¸èƒ½è¿è¡Œå¤ªé•¿çš„æ—¶é—´ã€‚å› ä¸ºäº‹åŠ¡å¯èƒ½æ¶‰åŠå¯¹åç«¯æ•°æ®åº“çš„é”å®šï¼Œæ‰€ä»¥é•¿æ—¶é—´çš„äº‹åŠ¡ä¼šä¸å¿…è¦çš„å ç”¨æ•°æ®åº“èµ„æºã€‚äº‹åŠ¡è¶…æ—¶å°±æ˜¯äº‹åŠ¡çš„ä¸€ä¸ªå®šæ—¶å™¨ï¼Œåœ¨ç‰¹å®šæ—¶é—´å†…äº‹åŠ¡å¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨å›æ»šï¼Œè€Œä¸æ˜¯ä¸€ç›´ç­‰å¾…å…¶ç»“æŸã€‚</p><h4 id="å›æ»šè§„åˆ™" tabindex="-1"><a class="header-anchor" href="#å›æ»šè§„åˆ™"><span>å›æ»šè§„åˆ™</span></a></h4><p>äº‹åŠ¡äº”è¾¹å½¢çš„æœ€åä¸€ä¸ªæ–¹é¢æ˜¯ä¸€ç»„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™å®šä¹‰äº†å“ªäº›å¼‚å¸¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šè€Œå“ªäº›ä¸ä¼šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åªæœ‰é‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸æ—¶æ‰ä¼šå›æ»šï¼Œè€Œåœ¨é‡åˆ°æ£€æŸ¥å‹å¼‚å¸¸æ—¶ä¸ä¼šå›æ»šï¼ˆè¿™ä¸€è¡Œä¸ºä¸ EJB çš„å›æ»šè¡Œä¸ºæ˜¯ä¸€è‡´çš„ï¼‰<br> ä½†æ˜¯ä½ å¯ä»¥å£°æ˜äº‹åŠ¡åœ¨é‡åˆ°ç‰¹å®šçš„æ£€æŸ¥å‹å¼‚å¸¸æ—¶åƒé‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸é‚£æ ·å›æ»šã€‚åŒæ ·ï¼Œä½ è¿˜å¯ä»¥å£°æ˜äº‹åŠ¡é‡åˆ°ç‰¹å®šçš„å¼‚å¸¸ä¸å›æ»šï¼Œå³ä½¿è¿™äº›å¼‚å¸¸æ˜¯è¿è¡ŒæœŸå¼‚å¸¸ã€‚</p><h3 id="transactionstatus" tabindex="-1"><a class="header-anchor" href="#transactionstatus"><span>TransactionStatus</span></a></h3><p><code>TransactionStatus</code> æ¥å£ä¸ºäº‹åŠ¡ä»£ç æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥æ§åˆ¶äº‹åŠ¡æ‰§è¡Œå’ŒæŸ¥è¯¢äº‹åŠ¡çŠ¶æ€ã€‚è¿™äº›æ¦‚å¿µåº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œå› ä¸ºå®ƒä»¬å¯¹æ‰€æœ‰äº‹åŠ¡ API éƒ½æ˜¯é€šç”¨çš„ã€‚ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº† <code>TransactionStatus</code> æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionStatus</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionExecution</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SavepointManager</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Flushable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> isNewTransaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> hasSavepoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> setRollbackOnly</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> isRollbackOnly</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> flush</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> isCompleted</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥å‘ç°è¿™ä¸ªæ¥å£æè¿°çš„æ˜¯ä¸€äº›å¤„ç†äº‹åŠ¡æä¾›ç®€å•çš„æ§åˆ¶äº‹åŠ¡æ‰§è¡Œå’ŒæŸ¥è¯¢äº‹åŠ¡çŠ¶æ€çš„æ–¹æ³•ï¼Œåœ¨å›æ»šæˆ–æäº¤çš„æ—¶å€™éœ€è¦åº”ç”¨å¯¹åº”çš„äº‹åŠ¡çŠ¶æ€ã€‚</p><h3 id="transactiontemplate" tabindex="-1"><a class="header-anchor" href="#transactiontemplate"><span>TransactionTemplate</span></a></h3><p>Spring æä¾›äº†å¯¹ç¼–ç¨‹å¼äº‹åŠ¡å’Œå£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒã€‚ç¼–ç¨‹å¼äº‹åŠ¡å…è®¸ç”¨æˆ·åœ¨ä»£ç ä¸­ç²¾ç¡®å®šä¹‰äº‹åŠ¡çš„è¾¹ç•Œï¼Œè€Œå£°æ˜å¼äº‹åŠ¡ï¼ˆåŸºäº AOPï¼‰æœ‰åŠ©äºç”¨æˆ·å°†æ“ä½œä¸äº‹åŠ¡è§„åˆ™è¿›è¡Œè§£è€¦ã€‚TransactionTemplate å°±æ˜¯ç”¨äºæ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡çš„æ ¸å¿ƒ APIã€‚</p><p>é‡‡ç”¨ TransactionTemplate å’Œé‡‡ç”¨å…¶ä»– Spring æ¨¡æ¿ï¼Œå¦‚ JdbcTempalte å’Œ HibernateTemplate æ˜¯ä¸€æ ·çš„æ–¹æ³•ã€‚å®ƒä½¿ç”¨å›è°ƒæ–¹æ³•ï¼ŒæŠŠåº”ç”¨ç¨‹åºä»å¤„ç†å–å¾—å’Œé‡Šæ”¾èµ„æºä¸­è§£è„±å‡ºæ¥ã€‚å¦‚åŒå…¶ä»–æ¨¡æ¿ï¼ŒTransactionTemplate æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä»£ç ç‰‡æ®µï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    TransactionTemplate</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tt </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> TransactionTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // æ–°å»ºä¸€ä¸ªTransactionTemplate</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> result </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> tt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> TransactionCallback</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doTransaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TransactionStatus</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                updateOperation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> resultOfUpdateOperation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    });</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // æ‰§è¡Œexecuteæ–¹æ³•è¿›è¡Œäº‹åŠ¡ç®¡ç†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ TransactionCallback()å¯ä»¥è¿”å›ä¸€ä¸ªå€¼ã€‚å¦‚æœä½¿ç”¨ TransactionCallbackWithoutResult åˆ™æ²¡æœ‰è¿”å›å€¼ã€‚</p><h2 id="å£°æ˜å¼äº‹åŠ¡ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#å£°æ˜å¼äº‹åŠ¡ç®¡ç†"><span>å£°æ˜å¼äº‹åŠ¡ç®¡ç†</span></a></h2><blockquote><p>å¤§å¤šæ•° Spring ç”¨æˆ·é€‰æ‹©å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚æ­¤é€‰é¡¹å¯¹åº”ç”¨ç¨‹åºä»£ç çš„å½±å“æœ€å°ï¼Œå› æ­¤æœ€ç¬¦åˆéä¾µå…¥å¼è½»é‡çº§å®¹å™¨çš„ç†æƒ³ã€‚</p></blockquote><p>Spring æ¡†æ¶çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ˜¯é€šè¿‡ Spring AOP å®ç°çš„ã€‚ç„¶è€Œï¼Œç”±äºäº‹åŠ¡æ–¹é¢ä»£ç éš Spring å‘è¡Œç‰ˆä¸€èµ·æä¾›å¹¶ä¸”å¯ä»¥ä»¥æ ·æ¿æ–¹å¼ä½¿ç”¨ï¼Œå› æ­¤é€šå¸¸ä¸å¿…ç†è§£ AOP æ¦‚å¿µå³å¯æœ‰æ•ˆåœ°ä½¿ç”¨æ­¤ä»£ç ã€‚</p><p>Spring æ¡†æ¶çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†ç±»ä¼¼äº EJB CMTï¼Œå› ä¸ºæ‚¨å¯ä»¥æŒ‡å®šäº‹åŠ¡è¡Œä¸ºï¼ˆæˆ–ç¼ºå°‘å®ƒï¼‰åˆ°å•ä¸ªæ–¹æ³•çº§åˆ«ã€‚å¦‚æœ‰å¿…è¦ï¼Œæ‚¨å¯ä»¥åœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œ <code>setRollbackOnly()</code> è°ƒç”¨ã€‚ä¸¤ç§ç±»å‹çš„äº‹åŠ¡ç®¡ç†ä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼š</p><ul><li>ä¸ç»‘å®šåˆ° JTA çš„ EJB CMT ä¸åŒï¼ŒSpring æ¡†æ¶çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†é€‚ç”¨äºä»»ä½•ç¯å¢ƒã€‚é€šè¿‡è°ƒæ•´é…ç½®æ–‡ä»¶ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ JDBCã€JPA æˆ– Hibernate å¤„ç† JTA äº‹åŠ¡æˆ–æœ¬åœ°äº‹åŠ¡ã€‚</li><li>æ‚¨å¯ä»¥å°† Spring å£°æ˜å¼äº‹åŠ¡ç®¡ç†åº”ç”¨äºä»»ä½•ç±»ï¼Œè€Œä¸ä»…ä»…æ˜¯è¯¸å¦‚ EJB ä¹‹ç±»çš„ç‰¹æ®Šç±»ã€‚</li><li>Spring æä¾›å£°æ˜æ€§å›æ»šè§„åˆ™ï¼Œè¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰ EJB ç­‰æ•ˆåŠŸèƒ½çš„ç‰¹æ€§ã€‚æä¾›äº†å¯¹å›æ»šè§„åˆ™çš„ç¼–ç¨‹å’Œå£°æ˜æ€§æ”¯æŒã€‚</li><li>Spring å…è®¸æ‚¨ä½¿ç”¨ AOP è‡ªå®šä¹‰äº‹åŠ¡è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨äº‹åŠ¡å›æ»šçš„æƒ…å†µä¸‹æ’å…¥è‡ªå®šä¹‰è¡Œä¸ºã€‚æ‚¨è¿˜å¯ä»¥æ·»åŠ ä»»æ„ advice ä»¥åŠäº‹åŠ¡æ€§ adviceã€‚ä½¿ç”¨ EJB CMTï¼Œæ‚¨æ— æ³•å½±å“å®¹å™¨çš„äº‹åŠ¡ç®¡ç†ï¼Œé™¤éä½¿ç”¨ <code>setRollbackOnly()</code>ã€‚</li><li>Spring ä¸åƒé«˜ç«¯åº”ç”¨æœåŠ¡å™¨é‚£æ ·æ”¯æŒè·¨è¿œç¨‹è°ƒç”¨ä¼ æ’­äº‹åŠ¡ä¸Šä¸‹æ–‡ã€‚å¦‚æœæ‚¨éœ€è¦æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨ EJBã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨è¿™ç§ç‰¹æ€§ä¹‹å‰è¦ä»”ç»†è€ƒè™‘ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸å¸Œæœ›äº‹åŠ¡è·¨è¶Šè¿œç¨‹è°ƒç”¨ã€‚</li></ul><p>å›æ»šè§„åˆ™çš„æ¦‚å¿µå¾ˆé‡è¦ã€‚å®ƒä»¬è®©æ‚¨æŒ‡å®šå“ªäº›å¼‚å¸¸ï¼ˆå’Œ throwableï¼‰åº”è¯¥å¯¼è‡´è‡ªåŠ¨å›æ»šã€‚æ‚¨å¯ä»¥åœ¨é…ç½®ä¸­ä»¥å£°æ˜æ–¹å¼æŒ‡å®šå®ƒï¼Œè€Œä¸æ˜¯åœ¨ Java ä»£ç ä¸­ã€‚å› æ­¤ï¼Œå°½ç®¡æ‚¨ä»ç„¶å¯ä»¥åœ¨ TransactionStatus å¯¹è±¡ä¸Šè°ƒç”¨ setRollbackOnly() æ¥å›æ»šå½“å‰äº‹åŠ¡ï¼Œä½†é€šå¸¸æ‚¨å¯ä»¥æŒ‡å®š MyApplicationException å¿…é¡»å§‹ç»ˆå¯¼è‡´å›æ»šçš„è§„åˆ™ã€‚æ­¤é€‰é¡¹çš„æ˜¾ç€ä¼˜åŠ¿æ˜¯ä¸šåŠ¡å¯¹è±¡ä¸ä¾èµ–äºäº‹åŠ¡åŸºç¡€æ¶æ„ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬é€šå¸¸ä¸éœ€è¦å¯¼å…¥ Spring äº‹åŠ¡ API æˆ–å…¶ä»– Spring APIã€‚</p><p>å°½ç®¡ EJB å®¹å™¨é»˜è®¤è¡Œä¸ºä¼šåœ¨ç³»ç»Ÿå¼‚å¸¸ï¼ˆé€šå¸¸æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼‰ä¸Šè‡ªåŠ¨å›æ»šäº‹åŠ¡ï¼Œä½† EJB CMT ä¸ä¼šåœ¨åº”ç”¨ç¨‹åºå¼‚å¸¸ï¼ˆå³é™¤ java.rmi.RemoteException ä¹‹å¤–çš„æ£€æŸ¥å¼‚å¸¸ï¼‰ä¸Šè‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚è™½ç„¶å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„ Spring é»˜è®¤è¡Œä¸ºéµå¾ª EJB çº¦å®šï¼ˆå›æ»šä»…åœ¨æœªç»æ£€æŸ¥çš„å¼‚å¸¸ä¸Šè‡ªåŠ¨ï¼‰ï¼Œä½†è‡ªå®šä¹‰æ­¤è¡Œä¸ºé€šå¸¸å¾ˆæœ‰ç”¨ã€‚</p><h3 id="spring-å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#spring-å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„å®ç°"><span>Spring å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„å®ç°</span></a></h3><p>å…³äº Spring æ¡†æ¶çš„å£°æ˜å¼äº‹åŠ¡æ”¯æŒï¼Œæœ€é‡è¦çš„æ¦‚å¿µæ˜¯è¿™ç§æ”¯æŒæ˜¯é€šè¿‡ AOP ä»£ç†å¯ç”¨çš„ï¼Œå¹¶ä¸”äº‹åŠ¡ advice æ˜¯ç”±å…ƒæ•°æ®é©±åŠ¨çš„ï¼ˆç›®å‰æ˜¯åŸºäº XML æˆ–åŸºäºæ³¨é‡Šçš„ï¼‰ã€‚ AOP ä¸äº‹åŠ¡å…ƒæ•°æ®çš„ç»“åˆäº§ç”Ÿäº†ä¸€ä¸ª AOP ä»£ç†ï¼Œå®ƒä½¿ç”¨ <code>TransactionInterceptor</code> å’Œé€‚å½“çš„ <code>TransactionManager</code> å®ç°æ¥é©±åŠ¨å›´ç»•æ–¹æ³•è°ƒç”¨çš„äº‹åŠ¡ã€‚</p><p>Spring çš„ <code>TransactionInterceptor</code> ä¸ºå‘½ä»¤å¼å’Œå“åº”å¼ç¼–ç¨‹æ¨¡å‹æä¾›äº‹åŠ¡ç®¡ç†ã€‚æ‹¦æˆªå™¨é€šè¿‡æ£€æŸ¥æ–¹æ³•è¿”å›ç±»å‹æ¥æ£€æµ‹æ‰€éœ€çš„äº‹åŠ¡ç®¡ç†é£æ ¼ã€‚è¿”å›å“åº”å¼ç±»å‹çš„æ–¹æ³•ï¼Œä¾‹å¦‚ Publisher æˆ– Kotlin Flowï¼ˆæˆ–å®ƒä»¬çš„å­ç±»å‹ï¼‰æœ‰èµ„æ ¼è¿›è¡Œå“åº”å¼äº‹åŠ¡ç®¡ç†ã€‚åŒ…æ‹¬ void åœ¨å†…çš„æ‰€æœ‰å…¶ä»–è¿”å›ç±»å‹éƒ½ä½¿ç”¨ä»£ç è·¯å¾„è¿›è¡Œå‘½ä»¤å¼äº‹åŠ¡ç®¡ç†ã€‚</p><p>äº‹åŠ¡ç®¡ç†é£æ ¼ä¼šå½±å“éœ€è¦å“ªä¸ªäº‹åŠ¡ç®¡ç†å™¨ã€‚å‘½ä»¤å¼äº‹åŠ¡éœ€è¦ <code>PlatformTransactionManager</code>ï¼Œè€Œå“åº”å¼äº‹åŠ¡ä½¿ç”¨ <code>ReactiveTransactionManager</code> å®ç°ã€‚</p><blockquote><p><code>@Transactional</code> é€šå¸¸ä¸ <code>PlatformTransactionManager</code> ç®¡ç†çš„çº¿ç¨‹ç»‘å®šäº‹åŠ¡ä¸€èµ·ä½¿ç”¨ï¼Œå°†äº‹åŠ¡å…¬å¼€ç»™å½“å‰æ‰§è¡Œçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ•°æ®è®¿é—®æ“ä½œã€‚æ³¨æ„ï¼šè¿™ä¸ä¼šä¼ æ’­åˆ°æ–¹æ³•ä¸­æ–°å¯åŠ¨çš„çº¿ç¨‹ã€‚</p><p>ç”± <code>ReactiveTransactionManager</code> ç®¡ç†çš„ååº”å¼äº‹åŠ¡ä½¿ç”¨ Reactor ä¸Šä¸‹æ–‡è€Œä¸æ˜¯çº¿ç¨‹æœ¬åœ°å±æ€§ã€‚å› æ­¤ï¼Œæ‰€æœ‰å‚ä¸çš„æ•°æ®è®¿é—®æ“ä½œéƒ½éœ€è¦åœ¨åŒä¸€ä¸ªååº”å¼ç®¡é“ä¸­çš„åŒä¸€ä¸ª Reactor ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚</p></blockquote><p>ä¸‹å›¾æ˜¾ç¤ºäº†åœ¨äº‹åŠ¡ä»£ç†ä¸Šè°ƒç”¨æ–¹æ³•çš„æ¦‚å¿µè§†å›¾ï¼š</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20220927093737.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="å£°æ˜å¼äº‹åŠ¡ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å£°æ˜å¼äº‹åŠ¡ç¤ºä¾‹"><span>å£°æ˜å¼äº‹åŠ¡ç¤ºä¾‹</span></a></h3><p>è€ƒè™‘ä»¥ä¸‹æ¥å£åŠå…¶ä¼´éšçš„å®ç°ã€‚æ­¤ç¤ºä¾‹ä½¿ç”¨ Foo å’Œ Bar ç±»ä½œä¸ºå ä½ç¬¦ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä¸“æ³¨äºäº‹åŠ¡ä½¿ç”¨ï¼Œè€Œæ— éœ€å…³æ³¨ç‰¹å®šçš„åŸŸæ¨¡å‹ã€‚å°±æœ¬ç¤ºä¾‹è€Œè¨€ï¼ŒDefaultFooService ç±»åœ¨æ¯ä¸ªå·²å®ç°æ–¹æ³•çš„ä¸»ä½“ä¸­æŠ›å‡º <code>UnsupportedOperationException</code> å®ä¾‹è¿™ä¸€äº‹å®å¾ˆå¥½ã€‚è¯¥è¡Œä¸ºä½¿æ‚¨å¯ä»¥çœ‹åˆ°æ­£åœ¨åˆ›å»ºçš„äº‹åŠ¡ï¼Œç„¶åå›æ»šä»¥å“åº” <code>UnsupportedOperationException</code> å®ä¾‹ã€‚</p><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº† FooService æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// the service interface that we want to make transactional</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> x.y.service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> FooService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Foo</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Foo</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> barName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> insertFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> updateFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸Šè¿°æ¥å£çš„å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> x.y.service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> DefaultFooService</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> FooService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Foo</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Foo</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> barName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> insertFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> updateFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡è®¾ FooService æ¥å£çš„å‰ä¸¤ä¸ªæ–¹æ³• getFoo(String) å’Œ getFoo(String, String) å¿…é¡»åœ¨å…·æœ‰åªè¯»è¯­ä¹‰çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œå¹¶ä¸”å…¶ä»–æ–¹æ³• insertFoo(Foo) å’Œ updateFoo(Foo )ï¼Œå¿…é¡»åœ¨å…·æœ‰è¯»å†™è¯­ä¹‰çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ä»¥ä¸‹é…ç½®å°†åœ¨æ¥ä¸‹æ¥çš„å‡ æ®µä¸­è¯¦ç»†è¯´æ˜ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- from the file &#39;context.xml&#39; --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> xmlns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:xsi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:aop</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/aop&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:tx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/tx&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xsi:schemaLocation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/beans</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/tx</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/tx/spring-tx.xsd</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/aop</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- this is the service object that we want to make transactional --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fooService&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;x.y.service.DefaultFooService&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- the transactional advice (what &#39;happens&#39;; see the &lt;aop:advisor/&gt; bean below) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> transaction-manager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!-- the transactional semantics... --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            &lt;!-- all methods starting with &#39;get&#39; are read-only --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;get*&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> read-only</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            &lt;!-- other methods use the default transaction settings (see below) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- ensure that the above transactional advice runs for any execution</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        of an operation defined by the FooService interface --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fooServiceOperation&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> expression</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;execution(* x.y.service.FooService.*(..))&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fooServiceOperation&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- don&#39;t forget the DataSource --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> destroy-method</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;driverClassName&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;oracle.jdbc.driver.OracleDriver&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;jdbc:oracle:thin:@rj-t42:1521:elvis&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;scott&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;password&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;tiger&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- similarly, don&#39;t forget the TransactionManager --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- other &lt;bean/&gt; definitions here --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ£€æŸ¥å‰é¢çš„é…ç½®ã€‚å®ƒå‡å®šæ‚¨è¦ä½¿æœåŠ¡å¯¹è±¡ fooService bean å…·æœ‰äº‹åŠ¡æ€§ã€‚è¦åº”ç”¨çš„äº‹åŠ¡è¯­ä¹‰å°è£…åœ¨ <code>&lt;tx:advice/&gt;</code> å®šä¹‰ä¸­ã€‚<code>&lt;tx:advice/&gt;</code> å®šä¹‰è¯»ä½œâ€œæ‰€æœ‰ä»¥ get å¼€å¤´çš„æ–¹æ³•éƒ½å°†åœ¨åªè¯»äº‹åŠ¡çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œæ‰€æœ‰å…¶ä»–æ–¹æ³•éƒ½å°†ä»¥é»˜è®¤äº‹åŠ¡è¯­ä¹‰è¿è¡Œâ€ã€‚<code>&lt;tx:advice/&gt;</code> æ ‡ç­¾çš„ <code>transaction-manager</code> å±æ€§è®¾ç½®ä¸ºå°†é©±åŠ¨äº‹åŠ¡çš„ TransactionManager bean çš„åç§°ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º txManager beanï¼‰ã€‚</p><blockquote><p>å¦‚æœè¦è¿æ¥çš„ TransactionManager çš„ bean åç§°å…·æœ‰åç§° transactionManagerï¼Œåˆ™å¯ä»¥çœç•¥äº‹åŠ¡ advice (tx:advice/) ä¸­çš„ transaction-manager å±æ€§ã€‚å¦‚æœè¦è¿æ¥çš„ TransactionManager bean æœ‰ä»»ä½•å…¶ä»–åç§°ï¼Œåˆ™å¿…é¡»æ˜¾å¼ä½¿ç”¨ transaction-manager å±æ€§ï¼Œå¦‚å‰é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚</p></blockquote><p><code>&lt;aop:config/&gt;</code> å®šä¹‰ç¡®ä¿ç”± <code>txAdvice</code> bean å®šä¹‰çš„äº‹åŠ¡æ€§å»ºè®®åœ¨ç¨‹åºä¸­çš„é€‚å½“ä½ç½®è¿è¡Œã€‚é¦–å…ˆï¼Œæ‚¨å®šä¹‰ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼Œè¯¥åˆ‡å…¥ç‚¹ä¸ <code>FooService</code> æ¥å£ (fooServiceOperation) ä¸­å®šä¹‰çš„ä»»ä½•æ“ä½œçš„æ‰§è¡Œç›¸åŒ¹é…ã€‚ç„¶åï¼Œæ‚¨ä½¿ç”¨ä¸€ä¸ª adviser å°†åˆ‡å…¥ç‚¹ä¸ <code>txAdvice</code> ç›¸å…³è”ã€‚ç»“æœè¡¨æ˜ï¼Œåœ¨æ‰§è¡Œ fooServiceOperation æ—¶ï¼Œä¼šè¿è¡Œ <code>txAdvice</code> å®šä¹‰çš„å»ºè®®ã€‚</p><p>ä¸€ä¸ªå¸¸è§çš„è¦æ±‚æ˜¯ä½¿æ•´ä¸ªæœåŠ¡å±‚å…·æœ‰äº‹åŠ¡æ€§ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯æ›´æ”¹åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä»¥åŒ¹é…æœåŠ¡å±‚ä¸­çš„ä»»ä½•æ“ä½œã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fooServiceMethods&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> expression</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;execution(* x.y.service.*.*(..))&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fooServiceMethods&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‰é¢æ˜¾ç¤ºçš„é…ç½®ç”¨äºå›´ç»•ä» fooService bean å®šä¹‰åˆ›å»ºçš„å¯¹è±¡åˆ›å»ºäº‹åŠ¡ä»£ç†ã€‚ä»£ç†é…ç½®äº†äº‹åŠ¡ adviceï¼Œä»¥ä¾¿åœ¨ä»£ç†ä¸Šè°ƒç”¨é€‚å½“çš„æ–¹æ³•æ—¶ï¼Œæ ¹æ®ä¸è¯¥æ–¹æ³•å…³è”çš„äº‹åŠ¡é…ç½®ï¼Œå¯åŠ¨ã€æš‚åœã€æ ‡è®°ä¸ºåªè¯»ç­‰äº‹åŠ¡ã€‚è€ƒè™‘ä»¥ä¸‹æµ‹è¯•é©±åŠ¨å‰é¢æ˜¾ç¤ºçš„é…ç½®çš„ç¨‹åºï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Boot</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ApplicationContext</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ClassPathXmlApplicationContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;context.xml&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        FooService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fooService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">FooService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        fooService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">insertFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Foo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å›æ»šä¸€ä¸ªå£°æ˜æ€§äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#å›æ»šä¸€ä¸ªå£°æ˜æ€§äº‹åŠ¡"><span>å›æ»šä¸€ä¸ªå£°æ˜æ€§äº‹åŠ¡</span></a></h3><p>Spring æ¡†æ¶ä¸­ï¼Œè§¦å‘äº‹åŠ¡å›æ»šçš„æ¨èæ–¹å¼æ˜¯åœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡çš„ä»£ç ä¸­æŠ›å‡ºå¼‚å¸¸ã€‚Spring äº‹åŠ¡æ¡†æ¶ä¼šæ•è·ä»»ä½•æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå¹¶ç¡®å®šæ˜¯å¦å°†äº‹åŠ¡æ ‡è®°ä¸ºå›æ»šã€‚</p><p>åœ¨å…¶é»˜è®¤é…ç½®ä¸­ï¼ŒSpring äº‹åŠ¡æ¡†æ¶åªä¼šå°†å­˜åœ¨è¿è¡Œæ—¶ä¸”æœªç»æ£€æŸ¥å¼‚å¸¸çš„äº‹åŠ¡æ ‡è®°ä¸ºå›æ»šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ <code>RuntimeException</code> çš„å®ä¾‹æˆ–å­ç±»æ—¶ã€‚ ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯å®ä¾‹ä¹Ÿä¼šå¯¼è‡´å›æ»šï¼‰ã€‚ä»äº‹åŠ¡æ–¹æ³•æŠ›å‡ºçš„æ£€æŸ¥å¼‚å¸¸ä¸ä¼šå¯¼è‡´é»˜è®¤é…ç½®ä¸­çš„å›æ»šã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡æŒ‡å®šå›æ»šè§„åˆ™ï¼Œæ˜ç¡®æŒ‡å®šå“ªäº›å¼‚å¸¸ç±»å‹å°†å¯¼è‡´äº‹åŠ¡å›æ»šã€‚</p><blockquote><p>å›æ»šè§„åˆ™çº¦å®šåœ¨æŠ›å‡ºæŒ‡å®šå¼‚å¸¸æ—¶æ˜¯å¦åº”å›æ»šäº‹åŠ¡ï¼Œå¹¶ä¸”è§„åˆ™åŸºäºæ¨¡å¼ã€‚æ¨¡å¼å¯ä»¥æ˜¯å®Œå…¨é™å®šçš„ç±»åæˆ–å¼‚å¸¸ç±»å‹çš„å®Œå…¨é™å®šç±»åçš„å­å­—ç¬¦ä¸²ï¼ˆå¿…é¡»æ˜¯ <code>Throwable</code> çš„å­ç±»ï¼‰ï¼Œç›®å‰ä¸æ”¯æŒé€šé…ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>javax.servlet.ServletException</code> æˆ– <code>ServletException</code> çš„å€¼å°†åŒ¹é… <code>javax.servlet.ServletException</code> åŠå…¶å­ç±»ã€‚</p><p>å›æ»šè§„åˆ™å¯ä»¥é€šè¿‡ <code>rollback-for</code> å’Œ <code>no-rollback-for</code> å±æ€§åœ¨ XML ä¸­é…ç½®ï¼Œè¿™å…è®¸å°†æ¨¡å¼æŒ‡å®šä¸ºå­—ç¬¦ä¸²ã€‚ä½¿ç”¨ <code>@Transactional</code> æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>rollbackFor</code> / <code>noRollbackFor</code> å’Œ<code>rollbackForClassName</code> / <code>noRollbackForClassName</code> å±æ€§é…ç½®å›æ»šè§„åˆ™ï¼Œå®ƒä»¬å…è®¸å°†æ¨¡å¼åˆ†åˆ«æŒ‡å®šä¸ºç±»å¼•ç”¨æˆ–å­—ç¬¦ä¸²ã€‚å½“å¼‚å¸¸ç±»å‹è¢«æŒ‡å®šä¸ºç±»å¼•ç”¨æ—¶ï¼Œå…¶å®Œå…¨é™å®šåç§°å°†ç”¨ä½œæ¨¡å¼ã€‚å› æ­¤ï¼Œ<code>@Transactional(rollbackFor = example.CustomException.class)</code> ç­‰ä»·äº <code>@Transactional(rollbackForClassName = &#39;example.CustomException&#39;)</code>ã€‚</p></blockquote><p>ä»¥ä¸‹ XML ç‰‡æ®µæ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡ <code>rollback-for</code> å±æ€§æä¾›å¼‚å¸¸æ¨¡å¼æ¥ä¸ºå·²æ£€æŸ¥çš„ã€ç‰¹å®šçš„ <code>Exception</code> ç±»å‹é…ç½®å›æ»šï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> transaction-manager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;get*&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> read-only</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> rollback-for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;NoProductInStockException&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ‚¨ä¸å¸Œæœ›åœ¨æŠ›å‡ºå¼‚å¸¸æ—¶å›æ»šäº‹åŠ¡ï¼Œæ‚¨è¿˜å¯ä»¥æŒ‡å®šâ€œä¸å›æ»šâ€è§„åˆ™ã€‚ä¸‹é¢çš„ä¾‹å­å‘Šè¯‰ Spring äº‹åŠ¡æ¡†æ¶ï¼Œå³ä½¿åœ¨é¢å¯¹æœªå¤„ç†çš„ InstrumentNotFoundException æ—¶ä¹Ÿè¦æäº¤ä¼´éšäº‹åŠ¡ã€‚</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;updateStock&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> no-rollback-for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;InstrumentNotFoundException&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ Spring Framework äº‹åŠ¡æ¡†æ¶æ•è·åˆ°å¼‚å¸¸ï¼Œå¹¶æ£€æŸ¥é…ç½®çš„å›æ»šè§„åˆ™ä»¥ç¡®å®šæ˜¯å¦å°†äº‹åŠ¡æ ‡è®°ä¸ºå›æ»šæ—¶ï¼Œç”±æœ€é‡è¦çš„åŒ¹é…è§„åˆ™å†³å®šã€‚å› æ­¤ï¼Œåœ¨ä»¥ä¸‹é…ç½®çš„æƒ…å†µä¸‹ï¼Œé™¤ <code>InstrumentNotFoundException</code> ä¹‹å¤–çš„ä»»ä½•å¼‚å¸¸éƒ½ä¼šå¯¼è‡´ä¼´éšäº‹åŠ¡çš„å›æ»šã€‚</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> rollback-for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Throwable&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> no-rollback-for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;InstrumentNotFoundException&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‚¨è¿˜å¯ä»¥ä»¥ç¼–ç¨‹æ–¹å¼æŒ‡ç¤ºæ‰€éœ€çš„å›æ»šã€‚è™½ç„¶å¾ˆç®€å•ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹éå¸¸å…·æœ‰ä¾µå…¥æ€§ï¼Œå¹¶ä¸”å°†æ‚¨çš„ä»£ç ä¸ Spring Framework çš„äº‹åŠ¡åŸºç¡€è®¾æ–½ç´§å¯†è€¦åˆã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä»¥ç¼–ç¨‹æ–¹å¼æŒ‡ç¤ºæ‰€éœ€çš„å›æ»šã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> resolvePosition</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // some business logic...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">NoProductInStockException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // trigger rollback programmatically</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        TransactionAspectSupport</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">currentTransactionStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setRollbackOnly</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœå¯èƒ½çš„è¯ï¼Œå¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨å£°æ˜æ€§æ–¹æ³•è¿›è¡Œå›æ»šã€‚å¦‚æœæ‚¨ç»å¯¹éœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ç¨‹åºåŒ–å›æ»šï¼Œä½†å®ƒçš„ä½¿ç”¨ä¸å®ç°å¹²å‡€çš„åŸºäº POJO çš„æ¶æ„èƒŒé“è€Œé©°ã€‚</p><h3 id="ä¸ºä¸åŒçš„-bean-é…ç½®ä¸åŒçš„äº‹åŠ¡è¯­ä¹‰" tabindex="-1"><a class="header-anchor" href="#ä¸ºä¸åŒçš„-bean-é…ç½®ä¸åŒçš„äº‹åŠ¡è¯­ä¹‰"><span>ä¸ºä¸åŒçš„ Bean é…ç½®ä¸åŒçš„äº‹åŠ¡è¯­ä¹‰</span></a></h3><p>è€ƒè™‘æ‚¨æœ‰è®¸å¤šæœåŠ¡å±‚å¯¹è±¡çš„åœºæ™¯ï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›å¯¹æ¯ä¸ªå¯¹è±¡åº”ç”¨å®Œå…¨ä¸åŒçš„äº‹åŠ¡é…ç½®ã€‚æ‚¨å¯ä»¥é€šè¿‡å®šä¹‰å…·æœ‰ä¸åŒ <code>&lt;aop:advisor/&gt;</code> å…ƒç´ å’Œä¸åŒ <code>advice-ref</code> å±æ€§å€¼çš„åˆ‡ç‚¹æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><p>ä½œä¸ºä¸€ä¸ªæ¯”è¾ƒç‚¹ï¼Œé¦–å…ˆå‡è®¾æ‚¨çš„æ‰€æœ‰æœåŠ¡å±‚ç±»éƒ½å®šä¹‰åœ¨æ ¹ x.y.service åŒ…ä¸­ã€‚ è¦ä½¿ä½œä¸ºè¯¥åŒ…ï¼ˆæˆ–å­åŒ…ï¼‰ä¸­å®šä¹‰çš„ç±»çš„å®ä¾‹å¹¶ä¸”åç§°ä»¥ Service ç»“å°¾çš„æ‰€æœ‰ bean éƒ½å…·æœ‰é»˜è®¤çš„äº‹åŠ¡é…ç½®ï¼Œæ‚¨å¯ä»¥ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> xmlns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:xsi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:aop</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/aop&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:tx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/tx&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xsi:schemaLocation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/beans</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/tx</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/tx/spring-tx.xsd</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/aop</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;serviceOperation&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                expression</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;execution(* x.y.service..*Service.*(..))&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;serviceOperation&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- these two beans will be transactional... --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fooService&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;x.y.service.DefaultFooService&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;barService&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;x.y.service.extras.SimpleBarService&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- ... and these two beans won&#39;t --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;anotherService&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.xyz.SomeService&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- (not in the right package) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;barManager&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;x.y.service.SimpleBarManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- (doesn&#39;t end in &#39;Service&#39;) --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;get*&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> read-only</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- other transaction infrastructure beans such as a TransactionManager omitted... --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨å®Œå…¨ä¸åŒçš„äº‹åŠ¡è®¾ç½®é…ç½®ä¸¤ä¸ªä¸åŒçš„ bean</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> xmlns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:xsi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:aop</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/aop&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:tx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/tx&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xsi:schemaLocation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/beans</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/tx</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/tx/spring-tx.xsd</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/aop</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;defaultServiceOperation&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                expression</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;execution(* x.y.service.*Service.*(..))&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;noTxServiceOperation&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                expression</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;execution(* x.y.service.ddl.DefaultDdlManager.*(..))&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;defaultServiceOperation&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;defaultTxAdvice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;noTxServiceOperation&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;noTxAdvice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- this bean will be transactional (see the &#39;defaultServiceOperation&#39; pointcut) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fooService&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;x.y.service.DefaultFooService&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- this bean will also be transactional, but with totally different transactional settings --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;anotherFooService&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;x.y.service.ddl.DefaultDdlManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;defaultTxAdvice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;get*&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> read-only</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;noTxAdvice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> propagation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;NEVER&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- other transaction infrastructure beans such as a TransactionManager omitted... --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tx-advice-é…ç½®" tabindex="-1"><a class="header-anchor" href="#tx-advice-é…ç½®"><span><code>&lt;tx:advice/&gt;</code> é…ç½®</span></a></h3><p><code>&lt;tx:advice/&gt;</code> çš„é»˜è®¤é…ç½®ä¸ºï¼š</p><ul><li><p>ä¼ æ’­è®¾ç½®æ˜¯ <code>REQUIRED</code></p></li><li><p>éš”ç¦»çº§åˆ«ä¸º <code>DEFAULT</code></p></li><li><p>äº‹åŠ¡æ˜¯ read-write</p></li><li><p>äº‹åŠ¡è¶…æ—¶é»˜è®¤ä¸ºåº•å±‚äº‹åŠ¡ç³»ç»Ÿçš„é»˜è®¤è¶…æ—¶ï¼Œå¦‚æœä¸æ”¯æŒè¶…æ—¶ï¼Œåˆ™ä¸ºæ— ã€‚</p></li><li><p>ä»»ä½• <code>RuntimeException</code> éƒ½ä¼šè§¦å‘å›æ»šï¼Œè€Œä»»ä½•å·²æ£€æŸ¥çš„ <code>Exception</code> éƒ½ä¸ä¼š</p></li></ul><p><code>&lt;tx:advice/&gt;</code> é…ç½®å±æ€§</p><table><thead><tr><th style="text-align:left;">å±æ€§</th><th style="text-align:left;">æ˜¯å¦å¿…è¦</th><th style="text-align:left;">é»˜è®¤å€¼</th><th style="text-align:left;">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left;"><code>name</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;"></td><td style="text-align:left;">ä¸äº‹åŠ¡å±æ€§å…³è”çš„æ–¹æ³•åç§°ã€‚æ”¯æŒé€šé…ç¬¦ï¼Œå¦‚ï¼š<code>get*</code>ã€<code>handle*</code>ã€<code>on*Event</code></td></tr><tr><td style="text-align:left;"><code>propagation</code></td><td style="text-align:left;">No</td><td style="text-align:left;"><code>REQUIRED</code></td><td style="text-align:left;">äº‹åŠ¡ä¼ æ’­è¡Œä¸º</td></tr><tr><td style="text-align:left;"><code>isolation</code></td><td style="text-align:left;">No</td><td style="text-align:left;"><code>DEFAULT</code></td><td style="text-align:left;">äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚ä»…é€‚ç”¨äº <code>REQUIRED</code> æˆ– <code>REQUIRES_NEW</code> çš„ä¼ æ’­è®¾ç½®ã€‚</td></tr><tr><td style="text-align:left;"><code>timeout</code></td><td style="text-align:left;">No</td><td style="text-align:left;">-1</td><td style="text-align:left;">äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚ä»…é€‚ç”¨äº <code>REQUIRED</code> æˆ– <code>REQUIRES_NEW</code> çš„ä¼ æ’­è®¾ç½®ã€‚</td></tr><tr><td style="text-align:left;"><code>read-only</code></td><td style="text-align:left;">No</td><td style="text-align:left;">false</td><td style="text-align:left;">read-write æˆ– read-only äº‹åŠ¡ã€‚</td></tr><tr><td style="text-align:left;"><code>rollback-for</code></td><td style="text-align:left;">No</td><td style="text-align:left;"></td><td style="text-align:left;">è§¦å‘å›æ»šçš„ <code>Exception</code> å®ä¾‹åˆ—è¡¨ï¼ˆé€šè¿‡é€—å·åˆ†éš”ï¼‰ã€‚</td></tr><tr><td style="text-align:left;"><code>no-rollback-for</code></td><td style="text-align:left;">No</td><td style="text-align:left;"></td><td style="text-align:left;">ä¸è§¦å‘å›æ»šçš„ <code>Exception</code> å®ä¾‹åˆ—è¡¨ï¼ˆé€šè¿‡é€—å·åˆ†éš”ï¼‰ã€‚</td></tr></tbody></table><h3 id="ä½¿ç”¨-transactional-æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-transactional-æ³¨è§£"><span>ä½¿ç”¨ <code>@Transactional</code> æ³¨è§£</span></a></h3><p>é™¤äº†åŸºäº XML çš„å£°æ˜å¼äº‹åŠ¡é…ç½®æ–¹æ³•ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨åŸºäºæ³¨è§£çš„æ–¹æ³•ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>@Transactional</code> æ³¨è§£çš„ç¤ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> DefaultFooService</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> FooService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Foo</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Foo</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> barName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> insertFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> updateFoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚ä¸Šæ‰€è¿°åœ¨ç±»çº§åˆ«ä½¿ç”¨ï¼Œ<code>@Transactional</code> æ³¨è§£è¡¨æ˜å£°æ˜ç±»ï¼ˆåŠå…¶å­ç±»ï¼‰çš„æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨é»˜è®¤äº‹åŠ¡é…ç½®ã€‚ æˆ–è€…ï¼Œå¯ä»¥å•ç‹¬ä¸ºæ¯ä¸ªæ–¹æ³•æŒ‡å®šæ³¨è§£ã€‚è¯·æ³¨æ„ï¼Œç±»çº§åˆ«çš„æ³¨è§£ä¸é€‚ç”¨äºç±»å±‚æ¬¡ç»“æ„ä¸­çš„ç¥–å…ˆç±»ï¼› åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç»§æ‰¿çš„æ–¹æ³•éœ€è¦åœ¨æœ¬åœ°é‡æ–°å£°æ˜æ‰èƒ½å‚ä¸å­ç±»çº§åˆ«çš„æ³¨è§£ã€‚</p><p>å½“ä¸Šé¢çš„ POJO ç±»åœ¨ Spring ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ä¸º bean æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ <code>@Configuration</code> ç±»ä¸­çš„ <code>@EnableTransactionManagement</code> æ³¨è§£ä½¿ bean å®ä¾‹å…·æœ‰äº‹åŠ¡æ€§ã€‚</p><p>åœ¨ XML é…ç½®ä¸­ï¼Œ <code>&lt;tx:annotation-driven/&gt;</code> æ ‡ç­¾æä¾›äº†ç±»ä¼¼çš„ä¾¿åˆ©ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- from the file &#39;context.xml&#39; --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> xmlns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:xsi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:aop</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/aop&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xmlns:tx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/tx&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    xsi:schemaLocation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/beans</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/tx</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/tx/spring-tx.xsd</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        http://www.springframework.org/schema/aop</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- this is the service object that we want to make transactional --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fooService&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;x.y.service.DefaultFooService&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- enable the configuration of transactional behavior based on annotations --&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- a TransactionManager is still required --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:annotation-driven</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> transaction-manager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!-- (this dependency is defined somewhere else) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- other &lt;bean/&gt; definitions here --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="transactional-é…ç½®" tabindex="-1"><a class="header-anchor" href="#transactional-é…ç½®"><span><code>@Transactional</code> é…ç½®</span></a></h4><table><thead><tr><th style="text-align:left;">Property</th><th style="text-align:left;">Type</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#tx-multiple-tx-mgrs-with-attransactional" target="_blank" rel="noopener noreferrer">value</a></td><td style="text-align:left;"><code>String</code></td><td style="text-align:left;">Optional qualifier that specifies the transaction manager to be used.</td></tr><tr><td style="text-align:left;"><code>transactionManager</code></td><td style="text-align:left;"><code>String</code></td><td style="text-align:left;">Alias for <code>value</code>.</td></tr><tr><td style="text-align:left;"><code>label</code></td><td style="text-align:left;">Array of <code>String</code> labels to add an expressive description to the transaction.</td><td style="text-align:left;">Labels may be evaluated by transaction managers to associate implementation-specific behavior with the actual transaction.</td></tr><tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#tx-propagation" target="_blank" rel="noopener noreferrer">propagation</a></td><td style="text-align:left;"><code>enum</code>: <code>Propagation</code></td><td style="text-align:left;">Optional propagation setting.</td></tr><tr><td style="text-align:left;"><code>isolation</code></td><td style="text-align:left;"><code>enum</code>: <code>Isolation</code></td><td style="text-align:left;">Optional isolation level. Applies only to propagation values of <code>REQUIRED</code> or <code>REQUIRES_NEW</code>.</td></tr><tr><td style="text-align:left;"><code>timeout</code></td><td style="text-align:left;"><code>int</code> (in seconds of granularity)</td><td style="text-align:left;">Optional transaction timeout. Applies only to propagation values of <code>REQUIRED</code> or <code>REQUIRES_NEW</code>.</td></tr><tr><td style="text-align:left;"><code>timeoutString</code></td><td style="text-align:left;"><code>String</code> (in seconds of granularity)</td><td style="text-align:left;">Alternative for specifying the <code>timeout</code> in seconds as a <code>String</code> valueâ€‰â€”â€‰for example, as a placeholder.</td></tr><tr><td style="text-align:left;"><code>readOnly</code></td><td style="text-align:left;"><code>boolean</code></td><td style="text-align:left;">Read-write versus read-only transaction. Only applicable to values of <code>REQUIRED</code> or <code>REQUIRES_NEW</code>.</td></tr><tr><td style="text-align:left;"><code>rollbackFor</code></td><td style="text-align:left;">Array of <code>Class</code> objects, which must be derived from <code>Throwable.</code></td><td style="text-align:left;">Optional array of exception types that must cause rollback.</td></tr><tr><td style="text-align:left;"><code>rollbackForClassName</code></td><td style="text-align:left;">Array of exception name patterns.</td><td style="text-align:left;">Optional array of exception name patterns that must cause rollback.</td></tr><tr><td style="text-align:left;"><code>noRollbackFor</code></td><td style="text-align:left;">Array of <code>Class</code> objects, which must be derived from <code>Throwable.</code></td><td style="text-align:left;">Optional array of exception types that must not cause rollback.</td></tr><tr><td style="text-align:left;"><code>noRollbackForClassName</code></td><td style="text-align:left;">Array of exception name patterns.</td><td style="text-align:left;">Optional array of exception name patterns that must not cause rollback.</td></tr></tbody></table><h4 id="å¤šäº‹åŠ¡ç®¡ç†å™¨åœºæ™¯ä¸‹ä½¿ç”¨-transactional" tabindex="-1"><a class="header-anchor" href="#å¤šäº‹åŠ¡ç®¡ç†å™¨åœºæ™¯ä¸‹ä½¿ç”¨-transactional"><span>å¤šäº‹åŠ¡ç®¡ç†å™¨åœºæ™¯ä¸‹ä½¿ç”¨ <code>@Transactional</code></span></a></h4><p>æŸäº›æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºä¸­å¯èƒ½éœ€è¦æ¥å…¥å¤šä¸ªæ•°æ®æºï¼Œç›¸åº”çš„ï¼Œä¹Ÿéœ€è¦å¤šä¸ªç‹¬ç«‹çš„äº‹åŠ¡ç®¡ç†å™¨ã€‚ä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨ <code>@Transactional</code> æ³¨é‡Šçš„ value æˆ– <code>transactionManager</code> å±æ€§æ¥é€‰æ‹©æ€§åœ°æŒ‡å®šè¦ä½¿ç”¨çš„ <code>TransactionManager</code> çš„æ ‡è¯†ã€‚è¿™å¯ä»¥æ˜¯ bean åç§°æˆ–äº‹åŠ¡ç®¡ç†å™¨ bean çš„é™å®šç¬¦å€¼ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionalService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;order&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> setSomething</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;account&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doSomething</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;reactive-account&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Mono</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doSomethingReactive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { ... }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢å±•ç¤ºå¦‚ä½•å®šä¹‰ <code>TransactionManager</code>ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tx:annotation-driven</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;transactionManager1&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">qualifier</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;order&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;transactionManager2&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">qualifier</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;account&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;transactionManager3&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework.data.r2dbc.connectionfactory.R2dbcTransactionManager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">qualifier</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;reactive-account&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>TransactionalService</code> ä¸Šçš„å„ä¸ªæ–¹æ³•åœ¨å•ç‹¬çš„äº‹åŠ¡ç®¡ç†å™¨ä¸‹è¿è¡Œï¼Œç”± orderã€account å’Œ reactive-account é™å®šç¬¦åŒºåˆ†ã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ˜ç¡®æŒ‡å®šçš„ <code>TransactionManager</code> beanï¼Œåˆ™ä»ä½¿ç”¨é»˜è®¤çš„ <code>&lt;tx:annotation-driven&gt;</code> ç›®æ ‡ bean åç§°ã€‚</p><h4 id="è‡ªå®šä¹‰ç»„åˆæ³¨è§£" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç»„åˆæ³¨è§£"><span>è‡ªå®šä¹‰ç»„åˆæ³¨è§£</span></a></h4><p>å¦‚æœæ‚¨å‘ç°åœ¨è®¸å¤šä¸åŒçš„æ–¹æ³•ä¸Šé‡å¤ä½¿ç”¨ <code>@Transactional</code> ç›¸åŒçš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ Spring çš„å…ƒæ³¨è§£è‡ªå®šä¹‰ç»„åˆæ³¨è§£ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Target</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">({</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ElementType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">METHOD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ElementType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">TYPE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">})</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Retention</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">RetentionPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">RUNTIME</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">transactionManager</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;order&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> label</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;causal-consistency&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;"> OrderTx</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Target</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">({</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ElementType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">METHOD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ElementType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">TYPE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">})</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Retention</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">RetentionPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">RUNTIME</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">transactionManager</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;account&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> label</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;retryable&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;"> AccountTx</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionalService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">OrderTx</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> setSomething</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">AccountTx</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doSomething</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯­æ³•æ¥å®šä¹‰äº‹åŠ¡ç®¡ç†å™¨é™å®šç¬¦å’Œäº‹åŠ¡æ ‡ç­¾ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒ…æ‹¬ä¼ æ’­è¡Œä¸ºã€å›æ»šè§„åˆ™ã€è¶…æ—¶å’Œå…¶ä»–ç‰¹æ€§ã€‚</p><h4 id="äº‹åŠ¡ä¼ æ’­" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡ä¼ æ’­"><span>äº‹åŠ¡ä¼ æ’­</span></a></h4><p>åœ¨ Spring ç®¡ç†çš„äº‹åŠ¡ä¸­ï¼Œè¯·æ³¨æ„ç‰©ç†äº‹åŠ¡å’Œé€»è¾‘äº‹åŠ¡ä¹‹é—´çš„å·®å¼‚ï¼Œä»¥åŠä¼ æ’­è®¾ç½®å¦‚ä½•åº”ç”¨äºè¿™ç§å·®å¼‚ã€‚</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20220928114544.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><code>PROPAGATION_REQUIRED</code> å¼ºåˆ¶æ‰§è¡Œç‰©ç†äº‹åŠ¡ï¼Œå¦‚æœå°šä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨å½“å‰èŒƒå›´çš„æœ¬åœ°æ‰§è¡Œæˆ–å‚ä¸æ›´å¤§èŒƒå›´å®šä¹‰çš„ç°æœ‰â€œå¤–éƒ¨â€äº‹åŠ¡ã€‚ è¿™æ˜¯åŒä¸€çº¿ç¨‹å†…çš„å¸¸è§è°ƒç”¨å †æ ˆå®‰æ’ä¸­çš„ä¸€ä¸ªå¾ˆå¥½çš„é»˜è®¤è®¾ç½®ï¼ˆä¾‹å¦‚ï¼Œå§”æ‰˜ç»™å¤šä¸ªå­˜å‚¨åº“æ–¹æ³•çš„æœåŠ¡å¤–è§‚ï¼Œå…¶ä¸­æ‰€æœ‰åº•å±‚èµ„æºéƒ½å¿…é¡»å‚ä¸æœåŠ¡çº§äº‹åŠ¡ï¼‰ã€‚</p><p>å½“ä¼ æ’­è®¾ç½®ä¸º PROPAGATION_REQUIRED æ—¶ï¼Œå°†ä¸ºåº”ç”¨è¯¥è®¾ç½®çš„æ¯ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ªé€»è¾‘äº‹åŠ¡èŒƒå›´ã€‚æ¯ä¸ªè¿™æ ·çš„é€»è¾‘äº‹åŠ¡èŒƒå›´å¯ä»¥å•ç‹¬ç¡®å®šä»…å›æ»šçŠ¶æ€ï¼Œå¤–éƒ¨äº‹åŠ¡èŒƒå›´åœ¨é€»è¾‘ä¸Šç‹¬ç«‹äºå†…éƒ¨äº‹åŠ¡èŒƒå›´ã€‚åœ¨æ ‡å‡† PROPAGATION_REQUIRED è¡Œä¸ºçš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¿™äº›èŒƒå›´éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªç‰©ç†äº‹åŠ¡ã€‚å› æ­¤ï¼Œåœ¨å†…éƒ¨äº‹åŠ¡èŒƒå›´å†…è®¾ç½®çš„ä»…å›æ»šæ ‡è®°ç¡®å®ä¼šå½±å“å¤–éƒ¨äº‹åŠ¡å®é™…æäº¤çš„æœºä¼šã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨å†…éƒ¨äº‹åŠ¡èŒƒå›´è®¾ç½®äº†ä»…å›æ»šæ ‡è®°çš„æƒ…å†µä¸‹ï¼Œå¤–éƒ¨äº‹åŠ¡å°šæœªå†³å®šå›æ»šæœ¬èº«ï¼Œå› æ­¤å›æ»šï¼ˆç”±å†…éƒ¨äº‹åŠ¡èŒƒå›´é™é»˜è§¦å‘ï¼‰æ˜¯æ„å¤–çš„ã€‚æ­¤æ—¶ä¼šå¼•å‘ç›¸åº”çš„ <code>UnexpectedRollbackException</code>ã€‚è¿™æ˜¯é¢„æœŸçš„è¡Œä¸ºï¼Œå› æ­¤äº‹åŠ¡çš„è°ƒç”¨è€…æ°¸è¿œä¸ä¼šè¢«è¯¯å¯¼ä»¥ä¸ºæ‰§è¡Œäº†æäº¤ï¼Œè€Œå®é™…ä¸Šå¹¶æ²¡æœ‰æ‰§è¡Œã€‚å› æ­¤ï¼Œå¦‚æœå†…éƒ¨äº‹åŠ¡ï¼ˆå¤–éƒ¨è°ƒç”¨è€…ä¸çŸ¥é“ï¼‰é»˜é»˜åœ°å°†äº‹åŠ¡æ ‡è®°ä¸ºä»…å›æ»šï¼Œå¤–éƒ¨è°ƒç”¨è€…ä»ä¼šè°ƒç”¨æäº¤ã€‚å¤–éƒ¨è°ƒç”¨è€…éœ€è¦æ¥æ”¶ <code>UnexpectedRollbackException</code> ä»¥æ¸…æ¥šåœ°æŒ‡ç¤ºæ‰§è¡Œäº†å›æ»šã€‚</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20220928115243.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>PROPAGATION_REQUIRES_NEW ä¸ PROPAGATION_REQUIRED ç›¸æ¯”ï¼Œå§‹ç»ˆä¸ºæ¯ä¸ªå—å½±å“çš„äº‹åŠ¡èŒƒå›´ä½¿ç”¨ç‹¬ç«‹çš„ç‰©ç†äº‹åŠ¡ï¼Œä»ä¸å‚ä¸å¤–éƒ¨èŒƒå›´çš„ç°æœ‰äº‹åŠ¡ã€‚ åœ¨è¿™ç§å®‰æ’ä¸‹ï¼Œåº•å±‚èµ„æºäº‹åŠ¡æ˜¯ä¸åŒçš„ï¼Œå› æ­¤å¯ä»¥ç‹¬ç«‹æäº¤æˆ–å›æ»šï¼Œå¤–éƒ¨äº‹åŠ¡ä¸å—å†…éƒ¨äº‹åŠ¡å›æ»šçŠ¶æ€çš„å½±å“ï¼Œå†…éƒ¨äº‹åŠ¡çš„é”åœ¨å®Œæˆåç«‹å³é‡Šæ”¾ã€‚ è¿™æ ·ä¸€ä¸ªç‹¬ç«‹çš„å†…éƒ¨äº‹åŠ¡ä¹Ÿå¯ä»¥å£°æ˜è‡ªå·±çš„éš”ç¦»çº§åˆ«ã€è¶…æ—¶å’Œåªè¯»è®¾ç½®ï¼Œè€Œä¸æ˜¯ç»§æ‰¿å¤–éƒ¨äº‹åŠ¡çš„ç‰¹æ€§ã€‚</p><h2 id="jdbc-å¼‚å¸¸æŠ½è±¡" tabindex="-1"><a class="header-anchor" href="#jdbc-å¼‚å¸¸æŠ½è±¡"><span>JDBC å¼‚å¸¸æŠ½è±¡</span></a></h2><p>Spring ä¼šå°†æ•°æ®æ“ä½œçš„å¼‚å¸¸è½¬æ¢ä¸º <code>DataAccessException</code>ã€‚</p><p>Spring æ˜¯æ€ä¹ˆè®¤è¯†é‚£äº›é”™è¯¯ç çš„</p><p>é€šè¿‡ SQLErrorCodeSQLExceptionTranslator è§£æé”™è¯¯ç </p><p>ErrorCode å®šä¹‰ï¼ˆsql-error-codes.xml æ–‡ä»¶ï¼‰</p><h2 id="spring-äº‹åŠ¡æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#spring-äº‹åŠ¡æœ€ä½³å®è·µ"><span>Spring äº‹åŠ¡æœ€ä½³å®è·µ</span></a></h2><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20200805171418.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="spring-äº‹åŠ¡æœªç”Ÿæ•ˆ" tabindex="-1"><a class="header-anchor" href="#spring-äº‹åŠ¡æœªç”Ÿæ•ˆ"><span>Spring äº‹åŠ¡æœªç”Ÿæ•ˆ</span></a></h3><p>ä½¿ç”¨ <code>@Transactional</code> æ³¨è§£å¼€å¯å£°æ˜å¼äº‹åŠ¡æ—¶ï¼Œ æœ€å®¹æ˜“å¿½ç•¥çš„é—®é¢˜æ˜¯ï¼Œå¾ˆå¯èƒ½äº‹åŠ¡å¹¶æ²¡æœ‰ç”Ÿæ•ˆã€‚</p><p><code>@Transactional</code> ç”Ÿæ•ˆåŸåˆ™ï¼š</p><h4 id="transactional-æ–¹æ³•å¿…é¡»æ˜¯-public" tabindex="-1"><a class="header-anchor" href="#transactional-æ–¹æ³•å¿…é¡»æ˜¯-public"><span>@Transactional æ–¹æ³•å¿…é¡»æ˜¯ public</span></a></h4><p>åŸåˆ™ä¸€ï¼šé™¤éç‰¹æ®Šé…ç½®ï¼ˆæ¯”å¦‚ä½¿ç”¨ AspectJ é™æ€ç»‡å…¥å®ç° AOPï¼‰ï¼Œå¦åˆ™<strong>åªæœ‰å®šä¹‰åœ¨ <code>public</code> æ–¹æ³•ä¸Šçš„ <code>@Transactional</code> æ‰èƒ½ç”Ÿæ•ˆ</strong>ã€‚åŸå› æ˜¯ï¼ŒSpring é»˜è®¤é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼å®ç° AOPï¼Œå¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œprivate æ–¹æ³•æ— æ³•ä»£ç†åˆ°ï¼ŒSpring è‡ªç„¶ä¹Ÿæ— æ³•åŠ¨æ€å¢å¼ºäº‹åŠ¡å¤„ç†é€»è¾‘ã€‚</p><p>ã€ç¤ºä¾‹ã€‘é”™è¯¯ä½¿ç”¨ <code>@Transactional</code> æ¡ˆä¾‹ä¸€</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUserPrivate</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> entity) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">		userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(entity);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">entity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">contains</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) { </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;invalid username!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	//ç§æœ‰æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUserWrong1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> name) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">			this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createUserPrivate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">		} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">			log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;create user failed because {}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">		}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">findByName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">	}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä¼ å…¥åä¸º test çš„ç”¨æˆ·å®ä½“ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½† <code>@Transactional</code> æœªç”Ÿæ•ˆï¼Œä¸ä¼šè§¦å‘å›æ»šã€‚</p><h4 id="å¿…é¡»é€šè¿‡-spring-æ³¨å…¥çš„-bean-è¿›è¡Œè°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#å¿…é¡»é€šè¿‡-spring-æ³¨å…¥çš„-bean-è¿›è¡Œè°ƒç”¨"><span>å¿…é¡»é€šè¿‡ Spring æ³¨å…¥çš„ Bean è¿›è¡Œè°ƒç”¨</span></a></h4><p>åŸåˆ™äºŒï¼š<strong>å¿…é¡»é€šè¿‡ä»£ç†è¿‡çš„ç±»ä»å¤–éƒ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•æ‰èƒ½ç”Ÿæ•ˆ</strong>ã€‚</p><p>ã€ç¤ºä¾‹ã€‘é”™è¯¯ä½¿ç”¨ <code>@Transactional</code> æ¡ˆä¾‹äºŒ</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	//è‡ªè°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUserWrong2</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> name) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">			this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createUserPublic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">		} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">			log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;create user failed because {}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">		}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">findByName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	//å¯ä»¥ä¼ æ’­å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUserPublic</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> entity) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">		userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(entity);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">entity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">contains</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) { </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;invalid username!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">	}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä¼ å…¥åä¸º test çš„ç”¨æˆ·å®ä½“ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½† <code>@Transactional</code> æœªç”Ÿæ•ˆï¼Œä¸ä¼šè§¦å‘å›æ»šã€‚</p><p>è¯´æ˜ï¼šSpring é€šè¿‡ AOP æŠ€æœ¯å¯¹æ–¹æ³•è¿›è¡Œå­—èŠ‚ç å¢å¼ºï¼Œè¦è°ƒç”¨å¢å¼ºè¿‡çš„æ–¹æ³•å¿…ç„¶æ˜¯è°ƒç”¨ä»£ç†åçš„å¯¹è±¡ã€‚</p><h3 id="äº‹åŠ¡è™½ç„¶ç”Ÿæ•ˆä½†æœªå›æ»š" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡è™½ç„¶ç”Ÿæ•ˆä½†æœªå›æ»š"><span>äº‹åŠ¡è™½ç„¶ç”Ÿæ•ˆä½†æœªå›æ»š</span></a></h3><p>é€šè¿‡ AOP å®ç°äº‹åŠ¡å¤„ç†å¯ä»¥ç†è§£ä¸ºï¼Œä½¿ç”¨ <code>tryâ€¦catchâ€¦</code> æ¥åŒ…è£¹æ ‡è®°äº† <code>@Transactional</code> æ³¨è§£çš„æ–¹æ³•ï¼Œå½“æ–¹æ³•å‡ºç°äº†å¼‚å¸¸å¹¶ä¸”æ»¡è¶³<strong>ä¸€å®šæ¡ä»¶</strong>çš„æ—¶å€™ï¼Œåœ¨ <code>catch</code> é‡Œé¢æˆ‘ä»¬å¯ä»¥è®¾ç½®äº‹åŠ¡å›æ»šï¼Œæ²¡æœ‰å¼‚å¸¸åˆ™ç›´æ¥æäº¤äº‹åŠ¡ã€‚</p><p>â€œä¸€å®šæ¡ä»¶â€ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ç‚¹ï¼š</p><p>ç¬¬ä¸€ï¼Œåªæœ‰å¼‚å¸¸ä¼ æ’­å‡ºäº†æ ‡è®°äº† @Transactional æ³¨è§£çš„æ–¹æ³•ï¼Œäº‹åŠ¡æ‰èƒ½å›æ»šã€‚åœ¨ Spring çš„ TransactionAspectSupport é‡Œæœ‰ä¸ª invokeWithinTransaction æ–¹æ³•ï¼Œé‡Œé¢å°±æ˜¯å¤„ç†äº‹åŠ¡çš„é€»è¾‘ã€‚</p><p>ç¬¬äºŒï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>å‡ºç° RuntimeExceptionï¼ˆéå—æ£€å¼‚å¸¸ï¼‰æˆ– Error çš„æ—¶å€™ï¼ŒSpring æ‰ä¼šå›æ»šäº‹åŠ¡</strong>ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Service</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserRepository</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	//å¼‚å¸¸æ— æ³•ä¼ æ’­å‡ºæ–¹æ³•ï¼Œå¯¼è‡´äº‹åŠ¡æ— æ³•å›æ»š</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUserWrong1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">			userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">			log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;create user failed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ex);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	//å³ä½¿å‡ºäº†å—æ£€å¼‚å¸¸ä¹Ÿæ— æ³•è®©äº‹åŠ¡å›æ»š</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUserWrong2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">		userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">		otherTask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	//å› ä¸ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸€å®šä¼šæŠ›å‡ºä¸€ä¸ªIOException</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> otherTask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">		Files</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">readAllLines</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Paths</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;file-that-not-exist&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ createUserWrong1 æ–¹æ³•ä¸­ä¼šæŠ›å‡ºä¸€ä¸ª RuntimeExceptionï¼Œä½†ç”±äºæ–¹æ³•å†… catch äº†æ‰€æœ‰å¼‚å¸¸ï¼Œå¼‚å¸¸æ— æ³•ä»æ–¹æ³•ä¼ æ’­å‡ºå»ï¼Œäº‹åŠ¡è‡ªç„¶æ— æ³•å›æ»šã€‚</p><p>åœ¨ createUserWrong2 æ–¹æ³•ä¸­ï¼Œæ³¨å†Œç”¨æˆ·çš„åŒæ—¶ä¼šæœ‰ä¸€æ¬¡ otherTask æ–‡ä»¶è¯»å–æ“ä½œï¼Œå¦‚æœæ–‡ä»¶è¯»å–å¤±è´¥ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·æ³¨å†Œçš„æ•°æ®åº“æ“ä½œå›æ»šã€‚è™½ç„¶è¿™é‡Œæ²¡æœ‰æ•è·å¼‚å¸¸ï¼Œä½†å› ä¸º otherTask æ–¹æ³•æŠ›å‡ºçš„æ˜¯å—æ£€å¼‚å¸¸ï¼ŒcreateUserWrong2 ä¼ æ’­å‡ºå»çš„ä¹Ÿæ˜¯å—æ£€å¼‚å¸¸ï¼Œäº‹åŠ¡åŒæ ·ä¸ä¼šå›æ»šã€‚</p><p>ã€è§£å†³æ–¹æ¡ˆä¸€ã€‘å¦‚æœä½ å¸Œæœ›è‡ªå·±æ•è·å¼‚å¸¸è¿›è¡Œå¤„ç†çš„è¯ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œ<strong>å¯ä»¥æ‰‹åŠ¨è®¾ç½® <code>TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();</code> è®©å½“å‰äº‹åŠ¡å¤„äºå›æ»šçŠ¶æ€</strong>ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUserRight1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> name) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">      userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">   } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">      log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;create user failed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ex);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">      TransactionAspectSupport</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">currentTransactionStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setRollbackOnly</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">   }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ã€è§£å†³æ–¹æ¡ˆäºŒã€‘åœ¨æ³¨è§£ä¸­å£°æ˜ <code>@Transactional(rollbackFor = Exception.class)</code>ï¼ŒæœŸæœ›é‡åˆ°æ‰€æœ‰çš„ Exception éƒ½å›æ»šäº‹åŠ¡ï¼ˆæ¥çªç ´é»˜è®¤ä¸å›æ»šå—æ£€å¼‚å¸¸çš„é™åˆ¶ï¼‰ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">rollbackFor</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUserRight2</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> name) throws IOException {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">   userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   otherTask</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»†åŒ–äº‹åŠ¡ä¼ æ’­æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ç»†åŒ–äº‹åŠ¡ä¼ æ’­æ–¹å¼"><span>ç»†åŒ–äº‹åŠ¡ä¼ æ’­æ–¹å¼</span></a></h3><p>å¦‚æœæ–¹æ³•æ¶‰åŠå¤šæ¬¡æ•°æ®åº“æ“ä½œï¼Œå¹¶å¸Œæœ›å°†å®ƒä»¬ä½œä¸ºç‹¬ç«‹çš„äº‹åŠ¡è¿›è¡Œæäº¤æˆ–å›æ»šï¼Œé‚£ä¹ˆ<br> æˆ‘ä»¬éœ€è¦è€ƒè™‘è¿›ä¸€æ­¥ç»†åŒ–é…ç½®äº‹åŠ¡ä¼ æ’­æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ <code>@Transactional</code> æ³¨è§£çš„ <code>Propagation</code> å±æ€§ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * {@link Propagation#REQUIRES_NEW} è¡¨ç¤ºæ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•æ—¶éœ€è¦å¼€å¯æ–°çš„äº‹åŠ¡ï¼Œå¹¶æŒ‚èµ·å½“å‰äº‹åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">propagation</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Propagation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">REQUIRES_NEW</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createSubUserWithExceptionRight</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> entity) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">   log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;createSubUserWithExceptionRight start&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">   userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(entity);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;invalid status&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å‚è€ƒèµ„æ–™" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™"><span>å‚è€ƒèµ„æ–™</span></a></h2><ul><li><a href="https://spring.io/" target="_blank" rel="noopener noreferrer">Spring å®˜ç½‘</a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/index.html" target="_blank" rel="noopener noreferrer">Spring å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/data.html" target="_blank" rel="noopener noreferrer">Spring Boot å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://time.geekbang.org/column/intro/100047701" target="_blank" rel="noopener noreferrer">ã€ŠJava ä¸šåŠ¡å¼€å‘å¸¸è§é”™è¯¯ 100 ä¾‹ã€‹</a></li></ul></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/coder-xuyong/blog/edit/main/src/posts/java/spring/02-Springæ•°æ®/03.Springä¹‹äº‹åŠ¡.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="vp-meta-info" data-allow-mismatch="text">2024/12/30 15:51:18</span></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 1299461580@qq.com">XuYong</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/blog/pages/cf19fd/" aria-label="Spring ä¹‹ JDBC"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Spring ä¹‹ JDBC</div></a><a class="route-link auto-link next" href="/blog/pages/a03d7b/" aria-label="Spring ä¹‹ JPA"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Spring ä¹‹ JPA<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">coder-xuyong çš„å°ç ´ç«™</div><div class="vp-copyright">Copyright Â© 2025 xuyong </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-Ou5sDjBQ.js" defer></script>
  </body>
</html>
